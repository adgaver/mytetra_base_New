<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:24pt; font-weight:600;">Анализ текста регулярными выражениями (RegExp) в Excel</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">73224 11.02.2018 </span><a href="https://www.planetaexcel.ru/upload/iblock/993/regexp.xlsm"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Скачать пример</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Одной из самых трудоемких и неприятных задач при работе с текстом в Excel является </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">парсинг </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">- разбор буквенно-цифровой &quot;каши&quot; на составляющие и извлечение из нее нужных нам фрагментов. Например: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">извлечение почтового индекса из адреса (хорошо, если индекс всегда в начале, а если нет?)</span> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">нахождение номера и даты счета из описания платежа в банковской выписке</span> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">извлечение ИНН из разношерстных описаний компаний в списке контрагентов</span> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">поиск номера автомобиля или артикула товара в описании и т.д. </span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Обычно во подобных случаях, после получасового муторного ковыряния в тексте вручную, в голову начинают приходить мысли как-то автоматизировать этот процесс (особенно если данных много). Решений тут несколько и с разной степенью сложности-эффективности: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Использовать </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">встроенные текстовые функции Excel</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> для поиска-нарезки-склейки текста: </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ЛЕВСИМВ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(LEFT)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ПРАВСИМВ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(RIGHT)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ПСТР </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(MID)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><a href="http://www.planetaexcel.ru/techniques/7/89/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">СЦЕПИТЬ </span></a><a href="http://www.planetaexcel.ru/techniques/7/89/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">(CONCATENATE) </span></a><a href="http://www.planetaexcel.ru/techniques/7/89/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">и ее аналоги</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ОБЪЕДИНИТЬ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(JOINTEXT)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><a href="http://www.planetaexcel.ru/techniques/7/2602/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">СОВПАД </span></a><a href="http://www.planetaexcel.ru/techniques/7/2602/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">(EXACT)</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> и т.д. Этот способ хорош, если в тексте есть четкая логика (например, индекс всегда в начале адреса). В противном случае формулы существенно усложняются и, порой, дело доходит даже до формул массива, что сильно тормозит на больших таблицах.</span> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Использование </span><a href="https://www.planetaexcel.ru/techniques/7/97/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">оператора проверки текстового подобия Like</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> из Visual Basic, обернутого в пользовательскую макро-функцию. Это позволяет реализовать более гибкий поиск с использованием символов подстановки (*,#,? и т.д.) К сожалению, этот инструмент не умеет извлекать нужную подстроку из текста - только проверять, содержится ли она в нем.</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Кроме вышеперечисленного, есть еще один подход, очень известный в узких кругах профессиональных программистов, веб-разработчиков и прочих технарей - это </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">регулярные выражения</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> (Regular Expressions = RegExp = &quot;регэкспы&quot; = &quot;регулярки&quot;). Упрощенно говоря, </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">RegExp - это язык, где с помощью специальных символов и правил производится поиск нужных подстрок в тексте, их извлечение или замена на другой текст</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Регулярные выражения - это очень мощный и красивый инструмент, на порядок превосходящий по возможностям все остальные способы работы с текстом. Многие языки программирования (C#, PHP, Perl, JavaScript...) и текстовые редакторы (Word, Notepad++...) поддерживают регулярные выражения. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Microsoft Excel, к сожалению, не имеет поддержки RegExp по-умолчанию &quot;из коробки&quot;, но это легко исправить с помощью VBA. Откройте редактор Visual Basic с вкладки </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Разработчик </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Developer)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> или сочетанием клавиш Alt+F11. Затем вставьте новый модуль через меню </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Insert - Module</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> и скопируйте туда текст вот такой макрофункции: </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#0000ff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">Public Function RegExpExtract(Text As String, Pattern As String, Optional Item As Integer = 1) As String </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    On Error GoTo ErrHandl </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    Set regex = CreateObject(&quot;VBScript.RegExp&quot;) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    regex.Pattern = Pattern </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    regex.Global = True </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    If regex.Test(Text) Then </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">        Set matches = regex.Execute(Text) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">        RegExpExtract = matches.Item(Item - 1) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">        Exit Function </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    End If </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">ErrHandl: </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">    RegExpExtract = CVErr(xlErrValue) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#0000ff;">End Function </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:4px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#0000ff;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#ffffff;">Теперь можно закрыть редактор Visual Basic и, вернувшись в Excel, опробовать нашу новую функцию. Синтаксис у нее следующий: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">=RegExpExtract( Txt ; Pattern ; Item )</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">где </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Txt </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">- ячейка с текстом, который мы проверяем и из которого хотим извлечь нужную нам подстроку</span> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Pattern </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">- маска (шаблон) для поиска подстроки</span> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Item </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">- порядковый номер подстроки, которую надо извлечь, если их несколько (если не указан, то выводится первое вхождение)</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Самое интересное тут, конечно, это Pattern - строка-шаблон из спецсимволов &quot;на языке&quot; RegExp, которая и задает, что именно и где мы хотим найти. Вот самые основные из них - для начала:</span> </p>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Паттерн</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Описание</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">.</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Самое простое - это точка. Она обозначает любой символ в шаблоне на указанной позиции.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\s</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Любой символ, выглядящий как пробел (пробел, табуляция или перенос строки).</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\S</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Анти-вариант предыдущего шаблона, т.е. любой НЕпробельный символ.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\d</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Любая цифра</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;"> \D</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Анти-вариант предыдущего, т.е. любая НЕ цифра</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\w</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Любой символ латиницы (A-Z), цифра или знак подчеркивания</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\W</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Анти-вариант предыдущего, т.е. не латиница, не цифра и не подчеркивание.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">[</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic; color:#37b44a;">символы</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В квадратных скобках можно указать один или несколько символов, разрешенных на указанной позиции в тексте. Например </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">ст[уо]л</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> будет соответствовать любому из слов: </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">стол </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">или </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">стул</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.<br />Также можно не перечислять символы, а задать их диапазоном через дефис, т.е. вместо </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[ABDCDEF]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> написать </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[A-F]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. или вместо </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[4567]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> ввести </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[4-7]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Например, для обозначения всех символов кириллицы можно использовать шаблон </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[а-яА-ЯёЁ]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">[^</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic; color:#37b44a;">символы</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если после открывающей квадратной скобки добавить символ &quot;крышки&quot; </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">^</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, то набор приобретет обратный смысл - на указанной позиции в тексте будут разрешены все символы, кроме перечисленных. Так, шаблон </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[^ЖМ]уть</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> найдет </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Путь </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">или </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Суть</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> или </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Забудь</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, но не </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Жуть </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">или </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Муть</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, например.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">|</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Логический оператор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ИЛИ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(OR)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> для проверки по любому из указанных критериев. Например </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">(счет|счёт|invoice)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> будет искать в тексте любое из указанных слов. Обычно набор вариантов заключается в скобки.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">^</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Начало строки</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">$</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Конец строки</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">\b</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Край слова</span> </p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#ffffff;">Если мы ищем определенное количество символов, например, шестизначный почтовый индекс или все трехбуквенные коды товаров, то на помощь нам приходят </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">квантификаторы </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">или </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">кванторы </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">- специальные выражения, задающие количество искомых знаков. Квантификаторы применяются к тому символу, что стоит перед ним: </span></p>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">  </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Квантор</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Описание</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">?</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Ноль или одно вхождение. Например </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">.?</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> будет означать один любой символ или его отсутствие.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Одно или более вхождений. Например </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> означает любое количество цифр (т.е. любое число от 0 до бесконечности).</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">*</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Ноль или более вхождений, т.е. любое количество. Так </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\s*</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> означает любое количество пробелов или их отсутствие.</span> </p></td></tr>
<tr>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">{</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#37b44a;">число</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> или<br /></span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">{</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#37b44a;">число1</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">,</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#37b44a;">число2</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">}</span> </p></td>
<td style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если нужно задать строго определенное количество вхождений, то оно задается в фигурных скобках. Например </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d{6}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> означает строго шесть цифр, а шаблон </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\s{2,5}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - от двух до пяти пробелов</span> </p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#ffffff;">Теперь давайте перейдем к самому интересному - разбору применения созданной функции и того, что узнали о паттернах на практических примерах из жизни. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Извлекаем числа из текста</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для начала разберем простой случай - нужно извлечь из буквенно-цифровой каши первое число, например мощность источников бесперебойного питания из прайс-листа: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Логика работы регулярного выражения тут простая: </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - означает любую цифру, а квантор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> говорит о том, что их количество должно быть одна или больше. Двойной минус перед функцией нужен, чтобы &quot;на лету&quot; преобразовать извлеченные символы в полноценное число из числа-как-текст.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Почтовый индекс</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">На первый взгляд, тут все просто - ищем ровно шесть цифр подряд. Используем спецсимвол </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> для цифры и квантор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">{6}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> для количества знаков:</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Однако, возможна ситуация, когда левее индекса в строке стоит еще один большой набор цифр подряд (номер телефона, ИНН, банковский счет и т.д.) Тогда наша регулярка выдернет из нее первых 6 цифр, т.е. сработает некорректно: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Чтобы этого не происходило, необходимо добавить в наше регулярное выражение по краям модификатор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\b</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> означающий конец слова. Это даст понять Excel, что нужный нам фрагмент (индекс) должен быть отдельным словом, а не частью другого фрагмента (номера телефона): </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Телефон</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Проблема с нахождением телефонного номера среди текста состоит в том, что существует очень много вариантов записи номеров - с дефисами и без, через пробелы, с кодом региона в скобках или без и т.д. Поэтому, на мой взгляд, проще сначала вычистить из исходного текста все эти символы с помощью нескольких вложенных друг в друга функций </span><a href="https://www.planetaexcel.ru/techniques/25/2775/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">ПОДСТАВИТЬ</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(SUBSTITUTE)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, чтобы он склеился в единое целое, а потом уже примитивной регуляркой </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d{11}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> вытаскивать 11 цифр подряд: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">ИНН</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Тут чуть сложнее, т.к. ИНН (в России) бывает 10-значный (у юрлиц) или 12-значный (у физлиц). Если не придираться особо, то вполне можно удовлетвориться регуляркой </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d{10,12}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, но она, строго говоря, будет вытаскивать все числа от 10 до 12 знаков, т.е. и ошибочно введенные 11-значные. Правильнее будет использовать два шаблона, связанных логическим ИЛИ оператором </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">|</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> (вертикальная черта): </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Обратите внимание, что в запросе мы сначала ищем 12-разрядные, и только потом 10-разрядные числа. Если же записать нашу регулярку наоборот, то она будет вытаскивать для всех, даже длинных 12-разрядных ИНН, только первые 10 символов. То есть после срабатывания первого условия дальнейшая проверка уже не производится: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Это принципиальное отличие оператора </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">|</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> от стандартной экселевской логической функции </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ИЛИ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(OR)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, где от перестановки аргументов результат не меняется. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Артикулы товаров</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Во многих компаниях товарам и услугам присваиваются уникальные идентификаторы - артикулы, SAP-коды, SKU и т.д. Если в их обозначениях есть логика, то их можно легко вытаскивать из любого текста с помощью регулярных выражений. Например, если мы знаем, что наши артикулы всегда состоят из трех заглавных английских букв, дефиса и последующего трехразрядного числа, то: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Логика работы шаблона тут проста. </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[A-Z]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - означает любые заглавные буквы латиницы. Следующий за ним квантор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">{3}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> говорит о том, что нам важно, чтобы таких букв было именно три. После дефиса мы ждем три цифровых разряда, поэтому добавляем на конце </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d{3}</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Денежные суммы</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Похожим на предыдущий пункт образом, можно вытаскивать и цены (стоимости, НДС...) из описания товаров. Если денежные суммы, например, указываются через дефис, то: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Паттерн </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> с квантором </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> ищет любое число до дефиса, а </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\d{2}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> будет искать копейки (два разряда) после. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если нужно вытащить не цены, а НДС, то можно воспользоваться третьим необязательным аргументом нашей функции RegExpExtract, задающим порядковый номер извлекаемого элемента. И, само-собой, можно заменить функцией </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ПОДСТАВИТЬ</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(SUBSTITUTE)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> в результатах дефис на стандартный десятичный разделитель и добавить двойной минус в начале, чтобы Excel интерпретировал найденный НДС как нормальное число:</span> </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Автомобильные номера</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если не брать спецтранспорт, прицепы и прочие мотоциклы, то стандартный российский автомобильный номер разбирается по принципу &quot;буква - три цифры - две буквы - код региона&quot;. Причем код региона может быть 2- или 3-значным, а в качестве букв применяются только те, что похожи внешне на латиницу. Таким образом, для извлечения номеров из текста нам поможет следующая регулярка: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Время</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для извлечения времени в формате ЧЧ:ММ подойдет такое регулярное выражение: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">После двоеточия фрагмент</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[0-5]\d</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, как легко сообразить, задает любое число в интервале 00-59. Перед двоеточием в скобках работают два шаблона, разделенных логическим ИЛИ (вертикальной чертой): </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">[0-1]\d</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - любое число в интервале 00-19</span> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">2[0-3]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - любое число в интервале 20-23</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">К полученному результату можно применить дополнительно еще и стандартную Excel'евскую функцию </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ВРЕМЯ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(TIME)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, чтобы преобразовать его в понятный программе и пригодный для дальнейших расчетов формат времени. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Проверка пароля</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Предположим, что нам надо проверить список придуманных пользователями паролей на корректность. По нашим правилам, в паролях могут быть только английские буквы (строчные или прописные) и цифры. Пробелы, подчеркивания и другие знаки препинания не допускаются. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Проверку можно организовать с помощью вот такой несложной регулярки: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">По сути, таким шаблоном мы требуем, чтобы между началом (</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">^</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">) и концом (</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">$</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">) в нашем тексте находились только символы из заданного в квадратных скобках набора. Если нужно проверить еще и длину пароля (например, не меньше 6 символов), то квантор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> можно заменить на интервал &quot;шесть и более&quot; в виде </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">{6,}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Город из адреса</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Допустим, нам нужно вытащить город из строки адреса. Поможет регулярка, извлекающая текст от &quot;г.&quot; до следующей запятой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Давайте разберем этот шаблон поподробнее.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если вы прочитали текст выше, то уже поняли, что некоторые символы в регулярных выражениях (точки, звездочки, знаки доллара и т.д.) несут особый смысл. Если же нужно искать сами эти символы, то перед ними ставится обратная косая черта (иногда это называют </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">экранированием</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">). Поэтому при поиске фрагмента &quot;г.&quot; мы должны написать в регулярке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">г\.</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> если ищем плюсик, то </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">\+</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> и т.д. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Следующих два символа в нашем шаблоне - точка и звездочка-квантор - обозначают любое количество любых символов, т.е. любое название города. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">На конце шаблона стоит запятая, т.к. мы ищем текст от &quot;г.&quot; до запятой. Но ведь в тексте может быть несколько запятых, правда? Не только после города, но и после улицы, дома и т.д. На какой из них будет останавливаться наш запрос? Вот за это отвечает вопросительный знак. Без него наша регулярка вытаскивала бы максимально длинную строку из всех возможных: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В терминах регулярных выражений, такой шаблон является &quot;жадным&quot;. Чтобы исправить ситуацию и нужен вопросительный знак - он делает квантор, после которого стоит, &quot;скупым&quot; - и наш запрос берет текст только до первой встречной запятой после &quot;г.&quot;:</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Имя файла из полного пути</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Еще одна весьма распространенная ситуация - вытащить имя файла из полного пути. Тут поможет простая регулярка вида: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Тут фишка в том, что поиск, по сути, происходит в обратном направлении - от конца к началу, т.к. в конце нашего шаблона стоит </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#9d0a0f;">$</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, и мы ищем все, что перед ним до первого справа обратного слэша. Бэкслэш заэкранирован, как и точка в предыдущем примере. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">P.S.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">&quot;Под занавес&quot; хочу уточнить, что все вышеописанное - это малая часть из всех возможностей, которые предоставляют регулярные выражения. Спецсимволов и правил их использования очень много и на эту тему написаны целые книги (рекомендую для начала хотя бы </span><a href="https://www.ozon.ru/context/detail/id/140304603/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">эту</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">). В некотором смысле, написание регулярных выражений - это почти искусство. Почти всегда придуманную регулярку можно улучшить или дополнить, сделав ее более изящной или способным работать с более широким диапазоном вариантов входных данных. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для анализа и разбора чужих регулярок или отладки своих собственных есть несколько удобных онлайн-сервисов: </span><a href="https://regex101.com/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">RegEx101</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, </span><a href="https://regexr.com"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">RegExr</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> и др.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">К сожалению, не все возможности классических регулярных выражений поддерживаются в VBA (например, обратный поиск или POSIX-классы) и умеют работать с кириллицей, но и того, что есть, думаю, хватит на первое время, чтобы вас порадовать.</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если же вы не новичок в теме, и вам есть чем поделиться - оставляйте полезные при работе в Excel регулярки в комментариях ниже. Один ум хорошо, а два сапога - пара!</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Ссылки по теме</span> </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/25/2775/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Замена и зачистка текста функцией ПОДСТАВИТЬ (SUBSTITUTE)</span></a> </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/7/98/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Поиск и подсветка символов латиницы в русском тексте</span></a> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/7/85/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Поиск ближайшего похожего текста (Иванов = Ивонов = Иваноф и т.д.)</span></a> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">  </p></body></html>