<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:medium; font-weight:600; color:#272626; background-color:#ffffff;">Пользовательская функция FnReorderSubsetOfColumns</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Можно упростить, описанный выше подход, с помощью пользовательской функции. Откройте книгу Excel, созданную в предыдущем разделе. Пройдите</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Данные</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> –&gt; </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Получить данные</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> –&gt; </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Из других источников</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> –&gt; </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Пустой запрос</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">. В редакторе PQ пройдите </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Главная</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> –&gt; </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Расширенный редактор</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">. Вставьте код:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px; font-family:'Monaco,MonacoRegular,Courier New,monospace'; font-size:12px; font-weight:496; color:#272626; background-color:#fdfdfd;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-1"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">tbl </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#800080;">as</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">table</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">reorderedColumns </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#800080;">as</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">list</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">offset </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#800080;">as</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">number</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-2"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">  </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#800080;">as</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">table</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> =&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-3"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">     </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">Table</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">.</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">ReorderColumns</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-4"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">        </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">tbl</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-5"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">        </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">List</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">.</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">InsertRange</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-6"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">           </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">List</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">.</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">Difference</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-7"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">           </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">Table</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">.</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">ColumnNames</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">tbl</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-8"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">           </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#000000;">reorderedColumns</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-9"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">        </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-10"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">        </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#002d7a;">offset</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-11"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">        </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#000000;">reorderedColumns</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-12"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">     </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2aca701126974-13"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">  </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">)</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Рис. 7. Пользовательская функция</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Переименуйте</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Запрос1</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> в </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">FnReorderSubsetOfColumns</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Вернитесь к запросу</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Sheet1</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">, удалите шаг </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-style:italic; color:#272626;">Переупорядоченные столбцы</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">. Щелкните на значке </span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-weight:600; color:#272626;">f</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; font-weight:600; color:#272626; vertical-align:sub;">x</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> в строке формул для создания нового шага. Введите:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:15px; font-family:'Monaco,MonacoRegular,Courier New,monospace'; font-size:12px; font-weight:496; color:#272626; background-color:#fdfdfd;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2acc994894498"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#5499de;">1</span></p></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="urvanov-syntax-highlighter-65e56daaa2acc994894498-1"></a><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;">=</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#004ed0;">FnReorderSubsetOfColumns</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:12px; font-weight:496; color:#b85c00;">#&quot;Повышенные заголовки&quot;, {&quot;City&quot;, &quot;Revenue&quot;}, 1)</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Функция FnReorderSubsetOfColumns получает таблицу, подмножество переупорядоченных имен столбцов в виде списка и индекс, начинающийся с нуля. Затем выполняется переупорядочение очень надежным способом, без ссылок на имена других столбцов. Файлы решения C10E03 — Solution.xlsx.</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626; background-color:#ffffff;">Есть и другие способы реализации функции Table.ReorderColumns, которые позволяют избежать ошибок обновления. Можно задать третий аргумент, который позволит игнорировать пропущенные поля или добавлять нулевые значения для пропущенных полей. И хотя эти методы предотвращают сбои обновления, они могут приводить к неожиданным результатам. Подробнее см.</span><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;"> </span><a href="https://datachant.com/2017/01/18/power-bi-pitfall-4/"><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; text-decoration: underline; color:#0000ff;">заметку</span></a><span style=" font-family:'Arial,Helvetica,sans-serif,Arial,Helvetica,sans-serif'; font-size:16px; color:#272626;">.</span></p></body></html>