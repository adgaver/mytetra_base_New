<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:57.6px; background-color:#ffffff;"><span style=" font-family:'MuseoSansCyrl-700'; font-size:xx-large; font-weight:600; color:#262626;">Решение ошибки UnicodeDecodeError при чтении CSV файла в Pandas</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:28px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Ошибки UnicodeDecodeError встречаются довольно часто при работе с данными в Python, особенно при чтении файлов с помощью библиотеки Pandas. Это происходит из-за того,</span></p>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Ошибки UnicodeDecodeError встречаются довольно часто при работе с данными в Python, особенно при чтении файлов с помощью библиотеки Pandas. Это происходит из-за того, что файл содержит символы, которые не могут быть прочитаны с использованием выбранной кодировки.</span></p>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Вот типичный пример такой ошибки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; font-size:medium; color:#444444; background-color:#eff0f1;">UnicodeDecodeError: 'utf-8' codec can't decode byte 0xda in position 6: invalid continuation byte</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MuseoSansCyrl-300,sans-serif'; font-size:medium; color:#444444; background-color:#eff0f1;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MuseoSansCyrl-300,sans-serif'; font-size:medium; color:#444444;"><br /></p>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Это значит, что Python пытается прочитать файл с использованием кодировки UTF-8, но встречает символ (в данном случае, байт с значением 0xda), который не является допустимым в этой кодировке.</span></p>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Самый простой способ решения этой проблемы – поменять кодировку при чтении файла. Например, можно использовать кодировку ‘latin1’ или ‘ISO-8859-1’, которые являются более «мягкими» и могут прочитать больше символов, чем UTF-8.</span></p>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Это можно сделать с помощью параметра </span><span style=" font-family:'Courier New'; font-size:medium; color:#180620;">encoding</span><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;"> функции </span><span style=" font-family:'Courier New'; font-size:medium; color:#180620;">read_csv</span><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:13px; margin-bottom:64px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MuseoSansCyrl-300,sans-serif'; font-size:medium; color:#444444; background-color:#ffffff;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" vertical-align:middle; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><a name="highlighter_536513"></a><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">1</span></p></td>
<td bgcolor="#ffffff" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">data </span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21;"> </span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">pd.read_csv(filepath, names</span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">fields, encoding</span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#0000ff;">'latin1'</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">)</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Если неизвестно, какая кодировка используется в файле, можно воспользоваться библиотекой </span><span style=" font-family:'Courier New'; font-size:medium; color:#180620;">chardet</span><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">, которая позволяет автоматически определить кодировку:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:13px; margin-bottom:64px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MuseoSansCyrl-300,sans-serif'; font-size:medium; color:#444444; background-color:#ffffff;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" vertical-align:middle; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">2</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">3</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">4</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">5</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:25px; -qt-block-indent:0; text-indent:0px; line-height:1%; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#aeaeae; background-color:#ffffff;">6</span></p></td>
<td bgcolor="#ffffff" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">import</span><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21;"> </span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">chardet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">with </span><span style=" font-family:'PT Mono'; font-size:medium; color:#ff1493;">open</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">(filepath, </span><span style=" font-family:'PT Mono'; font-size:medium; color:#0000ff;">'rb'</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">) as f:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21;">    </span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">result </span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21;"> </span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">chardet.detect(f.read())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px; background-color:#ffffff;"><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">data </span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#1b1f21;"> </span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">pd.read_csv(filepath, names</span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">fields, encoding</span><span style=" font-family:'PT Mono'; font-size:medium; font-weight:600; color:#da3369;">=</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">result[</span><span style=" font-family:'PT Mono'; font-size:medium; color:#0000ff;">'encoding'</span><span style=" font-family:'PT Mono'; font-size:medium; color:#000000;">])</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:25px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:25.2px;"><span style=" font-family:'MuseoSansCyrl-300'; font-size:medium; color:#180620;">Однако стоит отметить, что использование «мягкой» кодировки может привести к тому, что некоторые символы будут прочитаны неправильно. Если точное представление каждого символа важно для дальнейшей работы, возможно, придется вручную обработать эти символы или связаться с источником данных для уточнения используемой кодировки.</span></p></body></html>