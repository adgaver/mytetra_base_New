<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-body-487889018865058534"></a>Задача организовать периодический импорт из выгружаемых файлов <span style=" font-weight:600;">Excel</span> в таблицу <span style=" font-weight:600;">MS SQL Server</span>. Старые файлы для архива необходимо оставить.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more"></a>Данную задачу легко решить,используя стандартные средства SSIS.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="1.png"><img src="1.png" /></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1.Поток данных</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2. Задача сценарий, для переименования файлов.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В потоке данных выбираем «Источник Excel”</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; text-decoration: underline; color:#0000ff;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://1.bp.blogspot.com/-IzCmIzngx88/TzldH5zk4aI/AAAAAAAAADY/iFWsiiNE324/s1600/3-2.JPG"><img src="2.png" width="320" height="141" /></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном источнике выбираем  наш файл.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В сервер назначения указываем нашMS SQL Server, таблицу назначения,сопоставляем поля источника и назначения.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В объекте «сценарий» добавим текст скрипта по переименованию файла, я выбрал на языке VB:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">      </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">       Rename(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;c:\TestExcel1.xls&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;c:\TestExcel1_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">+ Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Year()) _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">                                         + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Month()) _</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">                                                  + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;_&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + Convert.ToString(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Date</span><span style=" font-family:'Courier New'; font-size:10pt;">.Now.Day()) + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;.xls&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Catch</span><span style=" font-family:'Courier New'; font-size:10pt;"> ex </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">As</span><span style=" font-family:'Courier New'; font-size:10pt;"> Exception</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">            </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">My</span><span style=" font-family:'Courier New'; font-size:10pt;">.Computer.FileSystem.WriteAllText(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot;C:\load_from_excel_error.log&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;">,Convert.ToString(Now()) + </span><span style=" font-family:'Courier New'; font-size:10pt; color:#a31515;">&quot; - Ошибка переименования файла или файла нет&quot;</span><span style=" font-family:'Courier New'; font-size:10pt;"> + vbCrLf, </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">True</span><span style=" font-family:'Courier New'; font-size:10pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt;">        </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">End</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">Try</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого наш пакет SSIS должен работать и иметь следующий результат:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1  .<span style=" font-size:7pt;">       </span>Загружает из файла Excel в БД MS SQL данные</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2   .<span style=" font-size:7pt;">     </span>Старый файл Excel переименовывается.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Все. Дальше можно настроитьразличные исключения, или поправить согласно вашим требованиям. Удачи.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comments"></a><span style=" font-weight:600;">1</span><span style=" font-weight:600;"> комментарий</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="5.png" /></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-style:italic;">Анонимный </span><span style=" color:#000000;">9 июля 2018 г., 11:23</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Коллега, каким образом можно импортировать бинарные данные как содержимое файла ексель, с целью вставки всего бинарного содержимого в поле varbinary(max) как прикрепленный файл? Столкнулся с необходимостью импорта нескольких тысяч файлов в виде поля data в моей бд crm, потом эта запись будет подтянута на страницу с задачами и прикрепленным файлом к активности</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>