<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Данная функция возвращает исходный текст web-страницы:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:9pt;"> GetHTTPResponse(</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> sURL </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span><span style=" font-family:'monospace'; font-size:9pt;">) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;MSXML2.XMLHTTP&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;GET&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, sURL, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' раскомментируйте следующие строки и подставьте верные IP, логин и пароль</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' если вы сидите за proxy</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' .setProxy 2, &quot;192.168.100.1:3128&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' .setProxyCredentials &quot;user&quot;, &quot;password&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        .send</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        GetHTTPResponse = .responseText</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Пример использования функции </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">GetHTTPResponse</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Private</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> ПримерИспользованияФункции_GetHTTPResponse()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' считываем исходный текст страницы ExcelVBA.ru в переменную txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    txt = GetHTTPResponse(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;http://ExcelVBA.ru&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' получаем путь к папке &quot;Рабочий стол&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    ПутьКРабочемуСтолу = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;WScript.Shell&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">).SpecialFolders(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;Desktop&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' сохраняем текст из переменной txt в файл PageText.txt на рабочем столе</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    SaveTXTfile ПутьКРабочемуСтолу &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;\PageText.txt&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' открываем созданный текстовый файл в Excel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    Workbooks.OpenText ПутьКРабочемуСтолу &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;\PageText.txt&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:9pt;"> SaveTXTfile(</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> filename </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> txt </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span><span style=" font-family:'monospace'; font-size:9pt;">) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Boolean</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:9pt;">: Err.Clear</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> fso = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;scripting.filesystemobject&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> ts = fso.CreateTextFile(filename, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">True</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    ts.Write txt: ts.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    SaveTXTfile = Err = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> ts = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:9pt;">: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> fso = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">PS: Если вас интересует ТЕКСТ страницы - используйте эту функцию: </span><a href="http://excelvba.ru/code/GetWebPageText"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://excelvba.ru/code/GetWebPageText</span></a></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Еще один вариант кода - где можно задать таймаут<br />(чтобы код не подвисал, если нет ответа от сайта в течение нескольких секунд)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">ВНИМАНИЕ: Надо подключить в Tools - References библиотеку Microsoft WinHTTP Services 5.1<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Const</span><span style=" font-family:'monospace'; font-size:9pt;"> TIMEOUT&amp; = 6    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' в секундах</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:9pt; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:9pt;"> GetResponse(</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> URL$) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:9pt;">: Err.Clear</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Static</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> WinHttpRequest</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Is</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">New</span><span style=" font-family:'monospace'; font-size:9pt;"> WinHttpRequest</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    xmlhttp.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;GET&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">True</span><span style=" font-family:'monospace'; font-size:9pt;">: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    xmlhttp.Send: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Not</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp.WaitForResponse(TIMEOUT&amp;) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        Debug.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;timeout&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Exit</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    GetResponse = xmlhttp.responsetext</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> test() </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' пример использования</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    txt = GetResponse(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;http://ExcelVBA.ru/&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    Debug.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:9pt;"> Len(txt) </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' возвращает длину текста: 62737 символов</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Ещё один пример функции - с возможностью задать кодировку:<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> ТекстВебСтраницы_вКодировке_Windows1251()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    URL$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;http://ExcelVBA.ru/&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    MsgBox GetHTTPResponse(URL$)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' MsgBox GetHTTPResponse(URL$, &quot;windows-1251&quot;) ' если бы сайт выдавал страницу в windows-1251</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:9pt;"> GetHTTPResponse(</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Optional</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> Encoding$) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;MSXML2.XMLHTTP&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;GET&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        .Send</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> Len(Encoding$) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span><span style=" font-family:'monospace'; font-size:9pt;"> CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;ADODB.Stream&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                filename$ = Environ(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;tmp&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">) &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;\response.txt&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Charset = Encoding$: .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Type</span><span style=" font-family:'monospace'; font-size:9pt;"> = 1        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' adTypeBinary:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;">: .Write oXMLHTTP.ResponseBody</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .SaveToFile filename$, 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Type</span><span style=" font-family:'monospace'; font-size:9pt;"> = 2        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">'adTypeText</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .LoadFromFile filename$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                GetHTTPResponse = .ReadText</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Close</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            GetHTTPResponse = .ResponseText</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> oXMLHTTP = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">' еще один вариант макроса для загрузки страницы<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> test_internet()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    URL$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;http://ExcelVBA.ru/&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Const</span><span style=" font-family:'monospace'; font-size:9pt;"> TIMEOUT&amp; = 6        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' в секундах</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;WinHttp.WinHttpRequest.5.1&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    xmlhttp.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;GET&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">True</span><span style=" font-family:'monospace'; font-size:9pt;">: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    xmlhttp.Send: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Not</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp.WaitForResponse(TIMEOUT&amp;) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        MsgBox </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;timeout&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Exit</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    txt$ = xmlhttp.responsetext</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    MsgBox txt, vbInformation, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;Длина ответа: &quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Len(txt)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></p>
<hr />
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">А эту заготовку кода я использую, когда пишу макросы для загрузки данных с сайтов<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> LoadInfo()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' On Error Resume Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:9pt;"> ra </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> Range: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> ra = Range(Range(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;b2&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">), Range(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;b&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Rows.Count).</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;">(xlUp))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> ra.Row = 1 </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:9pt;"> MsgBox </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;На листе не найден список ИНН&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, vbCritical: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Exit</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:9pt;"> cell </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> Range, txt$, res$, result_cell </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> Range, v</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Const</span><span style=" font-family:'monospace'; font-size:9pt;"> TIMEOUT&amp; = 6: </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Static</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Object</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Is</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;WinHttp.WinHttpRequest.5.1&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">For</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Each</span><span style=" font-family:'monospace'; font-size:9pt;"> cell </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">In</span><span style=" font-family:'monospace'; font-size:9pt;"> ra.Cells</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        URL$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;https://sbis.ru/contragents/&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Trim(cell)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        xmlhttp.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Open</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;GET&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">True</span><span style=" font-family:'monospace'; font-size:9pt;">: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        xmlhttp.Send: DoEvents</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Not</span><span style=" font-family:'monospace'; font-size:9pt;"> xmlhttp.WaitForResponse(TIMEOUT&amp;) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            Debug.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;timeout&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, URL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            txt$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">: txt$ = xmlhttp.responsetext</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' обработка ответа сервера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' функцию GetTags можно взять здесь: excelvba.ru/code/html</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            res$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">: res$ = GetTags(txt, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;div&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;class&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;cCard__Content-Var&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;config 1&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            res$ = Replace(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;%22&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;'&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">): res$ = Replace(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&quot;&quot;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;'&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' ищем в ответе нужные данные</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span><span style=" font-family:'monospace'; font-size:9pt;"> cell.EntireRow</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(3) = Replace(GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;УставнойКапитал&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">), </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot; &quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(4) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;Статус&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(5) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;ВыручкаСтатистика&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(6) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;ПрибыльСтатистика&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(7) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;Выручка&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(8) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;Прибыль&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">                .Cells(9) = GetValue(res$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;ЧисленностьСотрудников&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">With</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span><span style=" font-family:'monospace'; font-size:9pt;"> cell</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0"><thead>
<tr>
<td></td>
<td></td>
<td></td>
<td></td></tr></thead></table>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0"><thead>
<tr>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Вложение</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Размер</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Загрузки</span></p></td>
<td>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Последняя загрузка</span></p></td></tr></thead>
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://ExcelVBA.ru/sites/default/files/GetHTTPResponse.xls"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">GetHTTPResponse.xls</span></a></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">25 КБ</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">58</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">10 недель 2 дня назад</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>