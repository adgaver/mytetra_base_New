<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:11pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/URL_SetParameter"><span style=" font-size:9pt; text-decoration: underline; color:#0000ff;">Функция для добавления GET-параметра в ссылку (URL)</span></a><span style=" font-size:9pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:9pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/another"><span style=" text-decoration: underline; color:#0000ff;">Разное</span></a></li>
<li style=" font-size:9pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/hyperlinks"><span style=" text-decoration: underline; color:#0000ff;">Гиперссылки</span></a> </li></ul></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:9pt;">Если требуется добавить в URL новый GET-параметр, или заменить значение имеющегося, - можно воспользоваться этой функцией.</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> ПримерИспользования()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    $ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;http://market.yandex.ru/model.xml?modelid=968028&amp;np=0&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    URL$ = URL_SetParameter(URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;how&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;aprice&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">) </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' такого параметра нет - он добавляется</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    URL$ = URL_SetParameter(URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;np&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;1&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">) </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' такой параметр есть - он заменяется</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    Debug.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:9pt;"> URL$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' на выходе получаем ссылку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' &lt;a href=&quot;http://market.yandex.ru/model.xml?modelid=968028&amp;hid=512743&amp;how=aprice&amp;np=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot; title=&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">http://market.yandex.ru/model.xml?modelid=968028&amp;hid=512743&amp;how=aprice&amp;np=1</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&gt;http://market.yandex.ru/model.xml?modelid=968028&amp;hid=512743&amp;how=aprice&amp;n...&lt;/a&gt; Sub</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:9pt;">Код функции:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span><span style=" font-family:'monospace'; font-size:9pt;"> URL_SetParameter(</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> Param$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">ByVal</span><span style=" font-family:'monospace'; font-size:9pt;"> ParamValue$) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' в качестве параметра принимает исходную ссылку, название GET-параметра, и его значение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' находит в ссылке значение GET-параметра, и заменяет на новое</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' если в ссылке нет GET-параметра Param$ - добавляет его</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' Возвращает новую ссылку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">On</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Error</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Resume</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Dim</span><span style=" font-family:'monospace'; font-size:9pt;"> sep$, arr, suffix$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Select</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Case</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Case</span><span style=" font-family:'monospace'; font-size:9pt;"> InStr(1, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;?&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, vbTextCompare) &gt; 0: sep$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;?&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Case</span><span style=" font-family:'monospace'; font-size:9pt;"> InStr(1, URL$, </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&amp;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, vbTextCompare) &gt; 0: sep$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&amp;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Case</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span><span style=" font-family:'monospace'; font-size:9pt;">: sep$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Select</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> Len(sep$) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' GET-параметр Param$ присутствует в URL - меняем его значение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        arr = Split(URL$, sep$)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">UBound</span><span style=" font-family:'monospace'; font-size:9pt;">(arr) &gt; 1 </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            URL_SetParameter = arr(0) &amp; sep$ &amp; ParamValue$        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' ошибочная ссылка - 2 одинаковых параметра</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' корректная исходная ссылка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> arr(1) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Like</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;*&amp;*&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:9pt;"> suffix$ = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&amp;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Split(arr(1), </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&amp;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">, 2)(1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            URL_SetParameter = arr(0) &amp; sep$ &amp; ParamValue$ &amp; suffix$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' GET-параметр Param$ отсутствует в URL - добавляем его</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> URL$ </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Like</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;*[?]*=*&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            URL_SetParameter = URL$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;&amp;&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; ParamValue$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">            URL_SetParameter = URL$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;?&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; Param$ &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;=&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; ParamValue$</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Function</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:9pt;"><br /></p></body></html>