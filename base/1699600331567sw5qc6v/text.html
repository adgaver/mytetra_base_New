<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="post-title"></a><span style=" font-family:'Open Sans,sans-serif'; font-size:xx-large; font-weight:600; color:#333333; background-color:#ffffff;">К</span><span style=" font-family:'Open Sans,sans-serif'; font-size:xx-large; font-weight:600; color:#333333; background-color:#ffffff;">ак получить несколько значений в результате запроса Power Query</span></p>
<p style=" margin-top:0px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New'; font-style:italic; color:#008000;">//</span>Промежуточный этап из другого запроса</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#008000;">//-----------------------------------------------------------------------------   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">    </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">......</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">    FinalResult </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">=</span><span style=" font-family:'Courier New'; color:#000000;"> #</span><span style=" font-family:'Courier New'; color:#800000;">&quot;Последний этап&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#ff8000;">meta</span><span style=" font-family:'Courier New'; color:#000000;"> </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">[</span><span style=" font-family:'Courier New'; color:#000000;">MidStep </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">=</span><span style=" font-family:'Courier New'; color:#000000;"> #</span><span style=" font-family:'Courier New'; color:#800000;">&quot;Промежуточный этап&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">]</span><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#004080; background-color:#eeeeee;">in</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">    FinalResult</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#008000;">//-----------------------------------------------------------------------------    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#004080; background-color:#eeeeee;">let</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">    Источник</span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">=</span><span style=" font-family:'Courier New'; color:#000000;"> </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080c0;">Value.Metadata</span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">(</span><span style=" font-family:'Courier New'; color:#000000;"> Запрос_с_метаданными </span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">)[</span><span style=" font-family:'Courier New'; color:#000000;">MidStep</span><span style=" font-family:'Courier New'; font-weight:600; color:#0080ff;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#004080; background-color:#eeeeee;">in</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">    Источник</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-style:italic; color:#008000;">//-----------------------------------------------------------------------------  </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-style:italic; color:#008000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-style:italic; color:#008000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#777777;">Эта статья о работе надстройки Power Query к Excel 2010 и Excel 2013, редактора запросов Power BI и  группы команд “Get &amp; Transform” (“Получить и преобразовать”) в Excel 2016. Надеюсь, когда-нибудь эта чехарда закончится и мы сможем говорить просто Power Query.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Результатом вычисления запроса в Power Query является единственное значение. Как правило, речь идет о таблице, которую мы затем выгружаем на лист или в модель данных в Excel и Power BI. Это же требование относится также и к любым другим выражениям, вычисляемым Power Query, например, встроенным или пользовательским функциям, полям записей, записям в целом, и т.д.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Однако можно легко представить себе ситуацию, когда нам нужно, чтобы функция или запрос вместе с основным результатом вернули и другую информацию – дополнительный или промежуточный результат вычисления.</span></p>
<p style=" margin-top:16px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:x-large; font-weight:600; color:#555555; background-color:#ffffff;">Промежуточные и дополнительные результаты запросов</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Представьте, что в процессе сложных преобразований запроса</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> последним шагом под названием </span><a name="crayon-654dd7a285296338196510"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  мы получили нужный результат (таблицу), которую мы хотим загрузить в модель данных. Одним из промежуточных шагов в нашем запросе был расчет какой-то величины </span><a name="crayon-654dd7a28529e323897919"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , и мы хотели бы использовать ее в других выражениях или запросах:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">/</span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">/ Query1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">l</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">et</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Source</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// источник данных</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-4"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">    </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// какие-то шаги</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fffee2;"><a name="crayon-654dd7a2852a0678806657-5"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ValueX</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// промежуточный результат</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-6"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">    </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// еще какие-то шаги</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fffee2;"><a name="crayon-654dd7a2852a0678806657-7"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ResultTable</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">     </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// получаем таблицу-результат</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852a0678806657-8"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fffee2;"><a name="crayon-654dd7a2852a0678806657-9"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ResultTable</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">    </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// но она не содержит в себе данные для получения ValueX</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Нам в итоге нужен и</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852a2925538693"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , и, конечно же, </span><a name="crayon-654dd7a2852a3627522375"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> .</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">У нас есть</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; font-style:italic; color:#555555;">как минимум три способа это сделать:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:12px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Разбить запрос в нужной точке на два – в одном получим </span><a name="crayon-654dd7a2852a4189162806"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-size:18px;"> , в другом, ссылающемся на него – </span><a name="crayon-654dd7a2852a5151949417"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-size:18px;"> .</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Вернуть сразу несколько значений ( </span><a name="crayon-654dd7a2852a7952743068"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-size:18px;">  и </span><a name="crayon-654dd7a2852a8242352470"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-size:18px;"> ) в виде записи или списка.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:12px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Вернуть одно значение </span><a name="crayon-654dd7a2852a9312578773"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-size:18px;"> , и </span><a name="crayon-654dd7a2852ab153492326"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-size:18px;">  в виде метаданных.</span></li></ol>
<p style=" margin-top:16px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:x-large; font-weight:600; color:#555555; background-color:#ffffff;">Разбить запрос на части</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">С первым способом всё, в общем, понятно. Для этого есть специальная команда в меню по клику правой кнопкой мыши в панели шагов Power Query: «Извлечь предыдущий»:</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_276"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">И</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">звлечь предыдущие шаги в новый запрос</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">При помощи этой команды все шаги</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; color:#555555;">до текущего</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> будут выделены в </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; text-decoration: underline; color:#555555;">новый запрос</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">, а все шаги </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; color:#555555;">начиная с текущего</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> – останутся в </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">прежнем</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> запросе, причем в качестве источника для </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">прежнего</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> запроса будет использовано </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; text-decoration: underline; color:#555555;">имя нового запроса</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">. Имя для нового запроса будет задано при разделении. Таким образом, мы можем дать новому запросу имя </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">GetValueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">, и использовать его результат как для продолжения преобразований, так и в качестве источника для других запросов.</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_277"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">Р</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">азделяем запросы на несколько</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Этот подход – наиболее правильный и логичный, если мы можем непосредственно использовать</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852ac717604897"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  для получения </span><a name="crayon-654dd7a2852ad040616427"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  (то есть </span><a name="crayon-654dd7a2852af263019583"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  содержит всю необходимую информацию для получения </span><a name="crayon-654dd7a2852b0574811301"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> ).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#777777;">Если вы работаете только с пользовательским интерфейсом Power Query и не притрагиваетесь к строке формул или расширенному редактору для написания собственных шагов запроса, на этом в большинстве случаев можно и остановиться.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Но если</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; font-style:italic; color:#555555;">промежуточный шаг, который мы хотим извлечь из запроса</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">, содержит в себе только часть нужных данных, или вообще </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; font-style:italic; color:#555555;">скалярное значение</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> (например, мы рассчитали минимальную дату по столбцу, и в дальнейшем планируем ее использовать в других запросах) нам придется разбивать запрос немного ранее, и дублировать получение </span><a name="crayon-654dd7a2852b1776302230"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  в разных запросах:</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_278"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">Ч</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">тобы не нарушалась цепочка вычислений, запросы надо разбивать так, чтобы связанные могли без проблем получить нужные данные</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">На этом рисунке зеленая ветвь обозначает наш основной запрос, который мы разбили на два новых заранее, до шага получения искомого значения</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852b2995411090"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> . В красной ветке мы ссылаемся на </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">, чтобы получить отдельным запросом </span><a name="crayon-654dd7a2852b4418380244"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  для использования в запросах </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query2</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> и </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query3</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">А теперь представьте, что нам нужно получить еще и</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852b5576109781"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueY</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , и </span><a name="crayon-654dd7a2852b6552461055"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueZ</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , и еще несколько промежуточных значений (что является вполне реальным сценарием, если на входе у нас один большой массив данных, из которого мы строим модель). Цепочка зависимостей запросов разрастается, что может привести к самым разным последствиям – от неудобства ориентирования в большом документе и до количества обращений Power Query к источнику данных. Иногда этого избежать невозможно (да и не нужно), но иногда городить целый огород для того, чтобы воспользоваться всего одним числом – совершенно избыточно.</span></p>
<p style=" margin-top:16px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:x-large; font-weight:600; color:#555555; background-color:#ffffff;">Вернуть результат в виде записи или списка</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Этот вариант требует базового знания основных составных типов данных Power Query и того, как обращаться к ним или их частям.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">На самом деле всё просто. Если у нас есть два значения, A и B, мы можем составить из них составной тип данных “список” (list):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852b7873461775"></a><span style=" font-family:'inherit'; font-size:16px; color:#5499de;">1</span></p></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852b7873461775-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">M</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">yList</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">{</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">В таком случае для получения значения А нам нужно написать</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852ba668809450"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#004ed0; background-color:#fafafa;">M</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#004ed0; background-color:#fafafa;">yList</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">{</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#ce0000; background-color:#fafafa;">0</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">}</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , а для получения B – </span><a name="crayon-654dd7a2852bc705063240"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#004ed0; background-color:#fafafa;">M</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#004ed0; background-color:#fafafa;">yList</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">{</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#ce0000; background-color:#fafafa;">1</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">}</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , где число в фигурных скобках – индекс элемента, начиная с 0. Как видите, порядок элементов в списке важен.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Если мы хотим обратиться к элементам не по порядку, а по какому-то имени, то мы можем использовать составной тип “запись” (record):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852bd071596635-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">M</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">yRecord</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Give_me_A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Give_me_B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Тогда для получения значения A надо написать</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852be180298452"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">M</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">yRecord</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">[</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">Give_me_A</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">]</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , а для получения B – соответственно </span><a name="crayon-654dd7a2852bf853385062"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">M</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">yRecord</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">[</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">Give_me_B</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">]</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> . В этом случае порядок полей в записи уже не важен.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Пока мы не посчитали наш запрос окончательно, мы можем ссылаться на любой из его шагов по имени. Поэтому, например, если последний шаг в нашем запросе был</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852c1764991970-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">R</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">esultTable</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">…</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">то мы можем добавить еще один шаг:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852c2498802258-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">F</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">inalResult</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MainResult</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ResultTable</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MidStep</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ValueX</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">И так далее: можно хоть все шаги запроса перечислить в записи или списке и обращаться к ним из других запросов, если вам это зачем-то нужно.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Результатом нашего запроса</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> в этом случае будет уже не таблица, а запись. Чтобы сослаться на ее составные части в других запросах, мы будем уже писать так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852c3930440850-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">G</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">etTableFromQuery1</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Query1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MainResult</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">],</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// таблица-результат запроса Query1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852c3930440850-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">G</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">etValueXFromQuery1</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Query1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MidStep</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">],</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// промежуточный шаг из запроса Query1</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Этот способ вполне хорош, кроме одного большого «НО»: он годится только в том случае, если сам по себе</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852c5118623838"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  не будет выводиться как таблица на лист или в модель данных. Иначе нам придется написать еще один запрос, теперь уже к </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">, для того, чтобы просто вытащить упомянутый </span><a name="crayon-654dd7a2852c6808569767"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  в виде таблицы.</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_285"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">Е</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">сли результат запроса – запись, то для выгрузки на лист или в модель данных нужно получить значение поля, содержащего таблицу</span></p>
<p style=" margin-top:16px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:x-large; font-weight:600; color:#555555; background-color:#ffffff;">Используй meta, Люк</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">В Power Query к любому рассчитанному значению можно добавить дополнительную информацию в виде</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; font-style:italic; color:#555555;">метаданных</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> (метаданные – информация об информации, или дополнительная информация о каких-то данных). С концепцией метаданных в Power Query мы встречаемся постоянно, когда читаем описание функций в интерфейсе программы: текстовые описания функций и их параметров, а также примеры использования – всё это прикреплено к самой функции в виде метаданных.</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Самый простой способ добавить метаданные к какому-то значению – это использовать оператор</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852c7419537192"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">m</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">eta</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> . С его помощью мы можем к любому рассчитанному значению добавить метаданные в виде записи (пар «поле = значение»). Синтаксис его использования очень простой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852c8204171396-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">F</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">inalResult</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#004ed0;">ResultTable </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MidStep</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ValueX</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">В этом примере мы рассчитываем значение</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852ca477575093"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">F</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">inalResult</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  (которое равно значению выражения </span><a name="crayon-654dd7a2852cb850796537"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> ), а данные промежуточного шага </span><a name="crayon-654dd7a2852cc152401605"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  будут добавлены к нему в виде метаданных. </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-weight:600; color:#555555;">Внешне мы не увидим никаких изменений</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> – результатом запроса по-прежнему будет таблица </span><a name="crayon-654dd7a2852ce302032503"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">R</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">esultTable</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> ,</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_281"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">Н</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">есмотря на наличие метаданных, основной результат запроса ничем не отличается от обычного</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">а значение промежуточного шага не будет видно и доступно, пока мы не запросим его d в другом запросе специальной функцией:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852cf700772222-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">S</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ource</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">Value.Metadata</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Query1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">)</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Результатом этой функции будет запись, представляющая собой все метаданные значения</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852d0963999806"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">F</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">inalResult</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , в том числе некоторую служебную информацию.</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_283"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">В</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">от так выглядит запись с метаданными запроса. Обратите внимание на служебное поле QueryFolding</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Чтобы получить именно те данные, которые мы добавили сами, нам нужно уточнить поле мета-записи:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d1967579960-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">S</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">ource</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">Value.Metadata</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Query1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">)[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MidStep</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Мы получим именно искомое – значение</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852d2340169482"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">alueX</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> , которое мы передали под именем </span><a name="crayon-654dd7a2852d4810737451"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">M</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">idStep</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> .</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_282"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">З</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">начение, записанное в поле метаданных, может быть получено другим запросом</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Таким образом, мы можем без проблем выгружать запрос</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; font-style:italic; color:#555555;">Query1</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> на лист или в модель данных – с точки зрения типа результирующего значения ничего не изменилось. Но внутри Power Query мы теперь имеем доступ также и к метаданным, которые при необходимости можем извлечь и использовать где угодно:</span></p>
<p align="center" style=" margin-top:2px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a name="attachment_280"></a><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">О</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;">сновной результат </span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; font-weight:600; color:#aaaaaa;">ПЛЮС</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:14px; color:#aaaaaa;"> дополнительная информация в метаданных</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Хотя изначально метаданные предполагают расширение свойств и характеристик основного значения, то есть как бы описательную функцию, Power Query позволяет нам передавать в качестве метаданных что угодно – от скалярной величины, введенной вручную, до сложных составных типов, совершенно не связанных с основным значением.</span></p>
<p style=" margin-top:16px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Open Sans,sans-serif'; font-size:x-large; font-weight:600; color:#555555; background-color:#ffffff;">Тонкости работы с метаданными</span></p>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">При помощи оператора</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852d5121117746"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">m</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">eta</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  мы можем снабдить метаданными любое значение в запросе Power Query. Однако нужно учитывать некоторые тонкости:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:12px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Использовать </span><span style=" font-size:18px; font-weight:600;">метаданные для передачи дополнительной информации между шагами</span><span style=" font-size:18px;"> внутри запроса практически </span><span style=" font-size:18px; font-weight:600;">бессмысленно</span><span style=" font-size:18px;"> – мы всегда можем записать эту информацию в отдельный шаг (переменную) и ссылаться на него в нужных местах запроса. Есть исключения, когда мы используем метаданные в некоторых функциях-итераторах для передачи дополнительной информации между итерациями, но это тема для отдельной статьи.</span></li>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">При </span><span style=" font-size:18px; font-weight:600;">проведении каких-то операций над значениями</span><span style=" font-size:18px;">, имеющими метаданные, мы получаем новое значение, которое, как правило, </span><span style=" font-size:18px; font-weight:600;">не наследует метаданные</span><span style=" font-size:18px;">. Например, пусть у нас есть такой запрос:<br /></span></li>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:98px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">l</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">et</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение без метаданных</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">2</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">Тип</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#008000;">&quot;четное&quot;</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">],</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение с метаданными</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-4"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">С</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">&amp;</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">nbsp</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">;</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">*</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">&amp;nbsp;</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">B</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-5"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852d7812241304-6"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">C</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// метаданные не передались из B в C</span></p></td></tr></table>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Результат запроса – это выражение, идущее после ключевого слова </span><a name="crayon-654dd7a2852d8243566285"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">i</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">n</span><span style=" font-size:18px;">  (даже если это выражение – просто ссылка на имя последнего шага запроса). Для передачи дополнительной информации из одного запроса в другой запрос необходимо, чтобы </span><span style=" font-size:18px; font-weight:600;">метаданными было снабжено именно то значение</span><span style=" font-size:18px;">, которое является результатом запроса в целом:<br /></span></li>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:98px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852da288592778-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">FinalResultWithMeta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#004ed0;">Result </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MetaTag</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">MetaValue</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852da288592778-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852da288592778-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">FinalResultWithMeta</span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"><br />или<br /></span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:98px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852db257533967-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852db257533967-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852db257533967-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852db257533967-4"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">&amp;</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">nbsp</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">;</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">*</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">&amp;nbsp;</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">Оператор</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#008000;">&quot;умножение&quot;</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:5px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px; font-weight:600;">Метаданные можно добавлять или заменять</span><span style=" font-size:18px;">. Добавление производится так же посредством оператора </span><a name="crayon-654dd7a2852dc960809130"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">m</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">eta</span><span style=" font-size:18px;">  (в соответствии с принципами объединения записей), а замена – при помощи специальной функции </span><a name="crayon-654dd7a2852dd607865546"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">V</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#800080; background-color:#fafafa;">alue.ReplaceMetadata</span><span style=" font-size:18px;"> :<br /></span></li>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:98px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">l</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">et</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">1</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">NumberType</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#008000;">&quot;odd&quot;</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">],</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение = 1, метаданные: [NumberType = &quot;odd&quot;]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Color</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#008000;">&quot;Black&quot;</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">],</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение = 1, метаданные: [NumberType = &quot;odd&quot;, Color = &quot;Black&quot;]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-4"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">С</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">Value.ReplaceMetadata</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">(</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Length</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">5</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">])</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение = 1, метаданные: [Length = 5]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-5"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852df759490190-6"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">C</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">*</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">2</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ff8000;">// значение = 2, метаданных нет</span></p></td></tr></table>
<li style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;" style=" margin-top:0px; margin-bottom:12px; margin-left:18px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">В записи, с помощью которой мы создаем метаданные, </span><span style=" font-size:18px; font-weight:600;">значением конкретного мета-поля может быть что угодно</span><span style=" font-size:18px;"> – число, текст, список, другая запись, таблица и т.п. Например:<br /></span></li></ol>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'inherit'; font-size:16px; font-weight:496; color:#555555; background-color:#dddddd;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#999999;">M</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:18px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,monospace'; font-size:16px; font-weight:496; color:#555555;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:58px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td bgcolor="#dfefff" style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;"></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-1"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">l</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">et</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-2"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#ce0000;">1</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-3"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">“text”</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-4"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">C</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">{</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-5"></a><span style=" font-family:'inherit'; font-size:16px; color:#800080;">i</span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-654dd7a2852e0787595293-6"></a><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;">   </span><span style=" font-family:'inherit'; font-size:16px; color:#008000;">&quot;result&quot;</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#800080;">meta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">[</span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Ameta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">A</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Bmeta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">B</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">,</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">Cmeta</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#000000;">=</span><span style=" font-family:'inherit'; font-size:16px; color:#006fe0;"> </span><span style=" font-family:'inherit'; font-size:16px; color:#002d7a;">C</span><span style=" font-family:'inherit'; font-size:16px; color:#333333;">]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:30px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555; background-color:#ffffff;">Использование метаданных значительно расширяет возможности работы с данными и запросами в Power Query. В некоторых случаях метаданные – гораздо более удобный способ передачи составной информации, чем другие традиционные методы. Самое прагматичное и эффектное применение метаданных, которое мне пока встречалось – в функциях типа</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;"> </span><a name="crayon-654dd7a2852e2321406652"></a><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">L</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">ist</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#333333; background-color:#fafafa;">.</span><span style=" font-family:'inherit'; font-size:16px; font-weight:496; color:#002d7a; background-color:#fafafa;">Generate</span><span style=" font-family:'Source Sans Pro,sans-serif'; font-size:18px; color:#555555;">  при работе с многостраничными запросами к API (т.е. paginated API response). Об этом будет отдельный пост.</span></p></body></html>