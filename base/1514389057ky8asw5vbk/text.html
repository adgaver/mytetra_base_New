<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Python как язык макросов для OpenOffice.org</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Скриптовая оболочка OOo, поставляемая с OOo 2.0, поддерживает макросы на Python. В настоящее время поддержка ограничена, и работают только функции назначения и исполнения макросов через стандартный диалог Tools/Macro, тогда как редактирование и отладка макросов в графическом интерфейсе OpenOffice.org пока не предусмотрены (просто по причине нехватки ресурсов у разработчиков). Для создания и модификации скриптов на языке Питон можно использовать любой текстовый редактор. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Размещение скриптов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Скрипты, предназначенные для исполнения в OpenOffice.org, могут храниться следующим образом: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В пользовательском каталоге OpenOffice.org.</li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В общем каталоге OpenOffice.org.</li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Внутри документа OpenOffice.org.</li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:0px; margin-bottom:5px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Внутри пакетов UNO (uno-packages, в данной статье не рассматриваются). </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Пользовательский каталог является стандартным местом хранения для скриптов, написанных на Питоне. При этом скриптовые файлы просто сохраняются в файловой системе. В операционной системе Windows каталог обычно располагается здесь: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">%userprofile%\Application Data\OpenOffice.org 2.0\user\Scripts\python</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">А в *nix здесь: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">~/.openoffice.org.2.0/user/Scripts/python</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Обратите внимание на то, что может возникнуть необходимость в первоначальном создании последнего подкаталога &quot;python&quot;. Убедитесь, что слово &quot;python&quot; полностью набрано в нижнем регистре. Вы можете произвольно создавать глубоко вложенные подпапки. Их названия будут отражаться в графическом интерфейсе OOo. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Пример: вы можете поместить py-файл примера, приведенного далее, в обозначенную выше папку. После этого откройте диалог Tools/Macros/Run Macro и осуществите навигацию до нужной позиции. Щелкните по кнопке Run, чтобы выполнить скрипт, в результате чего откроется диалог с кнопкой и надписью (это уже будет работа макроса). Каждый щелчок мышкой по этой кнопке будет увеличивать число на надписи. Диалог можно закрыть при помощи клавиши ESC. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Код примера: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import uno</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import unohelper</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">from com.sun.star.awt import XActionListener</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">class MyActionListener( unohelper.Base, XActionListener ):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    def __init__(self, labelControl, prefix ):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        self.nCount = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        self.labelControl = labelControl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        self.prefix = prefix</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    def actionPerformed(self, actionEvent):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # increase click counter </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        self.nCount = self.nCount + 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        self.labelControl.setText( self.prefix + str( self.nCount ) )</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># 'translated' from the developer's guide chapter 11.6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">def createDialog():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    &quot;&quot;&quot;Opens a dialog with a push button and a label,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    clicking the button increases the label counter.&quot;&quot;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    try:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        ctx = uno.getComponentContext()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        smgr = ctx.ServiceManager</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # create the dialog model and set the properties </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel = smgr.createInstanceWithContext( </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            &quot;com.sun.star.awt.UnoControlDialogModel&quot;, ctx)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.PositionX = 100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.PositionY = 100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.Width = 150 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.Height = 100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.Title = &quot;Runtime Dialog Demo&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # create the button model and set the properties </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel = dialogModel.createInstance( </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            &quot;com.sun.star.awt.UnoControlButtonModel&quot; )</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.PositionX = 50</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.PositionY  = 30 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.Width = 50; </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.Height = 14; </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.Name = &quot;myButtonName&quot;; </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.TabIndex = 0;         </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        buttonModel.Label = &quot;Click Me&quot;; </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # create the label model and set the properties </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel = dialogModel.createInstance( </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            &quot;com.sun.star.awt.UnoControlFixedTextModel&quot; ); </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.PositionX = 40 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.PositionY = 60 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.Width  = 100 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.Height = 14 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.Name = &quot;myLabelName&quot; </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.TabIndex = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        labelModel.Label = &quot;Clicks &quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # insert the control models into the dialog model </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.insertByName( &quot;myButtonName&quot;, buttonModel); </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        dialogModel.insertByName( &quot;myLabelName&quot;, labelModel); </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # create the dialog control and set the model </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer = smgr.createInstanceWithContext( </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            &quot;com.sun.star.awt.UnoControlDialog&quot;, ctx); </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.setModel(dialogModel); </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # add the action listener</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.getControl(&quot;myButtonName&quot;).addActionListener(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            MyActionListener( controlContainer.getControl( &quot;myLabelName&quot; ), labelModel.Label ))</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # create a peer </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        toolkit = smgr.createInstanceWithContext( </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            &quot;com.sun.star.awt.ExtToolkit&quot;, ctx);       </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.setVisible(False);       </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.createPeer(toolkit, None);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # execute it</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.execute()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        # dispose the dialog </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        controlContainer.dispose()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    except Exception,e:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print str(e)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">g_exportedScripts = createDialog,</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Скрипты, которые будут использоваться всеми пользователями этой инсталляции OpenOffice.org, можно поместить в общий каталог, в котором находятся все скрипты, по умолчанию поставляемые вместе с OpenOffice.org. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Обычно в операционной системе Windows этот каталог находится здесь: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">C:\Program Files\OpenOffice.org 2.0\share\Scripts\python</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">А в *nix здесь: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">/usr/lib/openoffice/share/Scripts/python</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Документ OpenOffice.org представляет собой zip-файл, содержащий различные файлы и папки. Скрипты, написанные на языке Питон, хранятся внутри документа в подкаталоге Scripts/python. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы хотите разместить написанные вами скрипты внутри документа, то сначала вам необходимо создать их, например, в пользовательском каталоге (о котором упоминалось выше) и только затем при помощи архиватора переместить скрипты в документ. В идеальном случае вам нужно вначале убрать ваши скрипты из каталога, где вы их создавали и отлаживали, а затем провести тест функциональности документа. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">При открытии документа OpenOffice.org оповестит вас о том, что внутри документа находятся скрипты. Если оповещения не последовало, значит, вы либо отключили соответствующую опцию, либо сделали что-то неправильно. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Важно: при сохранении документа OpenOffice.org удалит ваши скрипты из документа, если вы не пропишете их заранее внутри документа в файле META-INF/manifest.xml: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">&lt;manifest:file-entry manifest:media-type=&quot;&quot; manifest:full-path=&quot;Scripts/python/my_script.py&quot;/&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">&lt;manifest:file-entry manifest:media-type=&quot;application/binary&quot; manifest:full-path=&quot;Scripts/python/&quot;/&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">&lt;manifest:file-entry manifest:media-type=&quot;application/binary&quot; manifest:full-path=&quot;Scripts/&quot;/&gt;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Написание скриптов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Макрос для скриптовой оболочки OpenOffice.org представляет собой функцию (введенную ключевым словом def) внутри py-файла. Чтобы можно было исполнить макрос при помощи диалога Tools/Macros/Run macro, список аргументов функции должен быть пуст (примечание: некоторые версии OpenOffice.org - наоборот, требуют наличие у функции единственного аргумента). Для обычных обработчиков событий (event listener), функция должна содержать только один аргумент – событие. В целом, количество аргументов зависит от того, где функция будет использоваться. Важно: в настоящее время .py-файл должен использовать переводы строк в стиле unix, однако в будущем это условие может измениться. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Один .py-файл может содержать произвольное количество определений функций. По умолчанию все определения функций экспортируются (т.е. отображаются внутри диалога OpenOffice.org, предназначенного для выбора макросов). Можно ограничить экспорт меньшим количеством функций, введя для этого глобальную переменную </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">g_exportedScripts</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, представляющую собой кортеж имён функций. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В настоящее время py-файлам под силу импортировать только модули питона, указанные в PYTHONPATH. Это означает, что py-файлы не могут ссылаться на другие макро-файлы, написанные на питоне. В будущем это ограничение, возможно, будет снято. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Перед исполнением кода модуля в качестве глобальной переменной в модуль импортируется глобальная переменная XSCRIPTCONTEXT (эта переменная также есть в javascript и beanshell, и вставлена в Питон из соображений совместимости). Переменная имеет три составляющие - Document, Desktop и ComponentContext. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Комментарий функции, начинающийся и заканчивающийся тремя двойными кавычками (&quot;), отображаются как описание в диалоге выбора макросов. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Устранение ошибок и отладка</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Возникающие во время компиляции или исполнения скриптов ошибки, там, где возможно, трактуются как исключения в скриптовой оболочке. Обычно скриптовая оболочка открывает всплывающее окно и отображает сообщение об исключении. Однако иногда это сделать невозможно и ошибка молча игнорируется. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В данный момент функция подключения отладчика Питона не поддерживается. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение к OpenOffice.org &quot;извне&quot;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">UNO (Universal Network Objects) является интерфейсом, предоставляющим доступ к компонентной модели OpenOffice.org для кроссплафторменного и языконезависимого программирования (это аналог технологии COM для Windows). Python-UNO bridge (PyUNO) позволяет как использовать OpenOffice.org API из языка Python, так и вызывать сценарии Python непосредственно в контексте документа OpenOffice.org (начиная с версии OOo 2.0), что и было описано выше. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Для того, чтобы скрипт успешно импортировал модуль </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">uno</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, необходимо запускать Python в каталоге, где этот модуль находится, т.е. в каталоге программы OpenOffice.org, который может выглядеть примерно так: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">/usr/lib/ooo-2.0/program</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если скрипт запускается в контексте OpenOffice.org (как макрос), модуль </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">uno</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> будет импортирован успешно в любом случае. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Кроме того, для успешного импортирования модуля </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">uno</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> можно прописать путь к каталогу программы OpenOffice.org в переменную среды </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">PYTHONPATH</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> различными способами. Например, запустить скрипт так: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">PYTHONPATH=$PYTHONPATH:/usr/lib/ooo-2.0/program python &lt;путь к скрипту&gt;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Или установить переменную среды PYTHONPATH непосредственно перед запуском скрипта: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">export PYTHONPATH=/usr/lib/ooo-2.0/program</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">python &lt;путь к скрипту&gt;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Или прописать установку переменной среды PYTHONPATH в автоматически загружаемом сценарии оболочки, например, в файле </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">~/.bashrc</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">export PYTHONPATH=$PYTHONPATH:/usr/lib/ooo-2.0/program</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Кроме того, можно прописать путь к нужному каталогу прямо в самом скрипте: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import sys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">sys.path.append('/usr/lib/ooo-2.0/program')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import uno</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">...</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Текст скрипта: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import uno</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># получаем контекст PyUNO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">localContext = uno.getComponentContext()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># создаём UnoUrlResolver</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">resolver = localContext.ServiceManager.createInstanceWithContext(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    &quot;com.sun.star.bridge.UnoUrlResolver&quot;, localContext)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># подключаемся к запущенному офису</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">ctx = resolver.resolve(&quot;uno:socket,host=localhost,port=2002;urp;StarOffice.ComponentContext&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">smgr = ctx.ServiceManager</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># получаем объект рабочего стола</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">desktop = smgr.createInstanceWithContext(&quot;com.sun.star.frame.Desktop&quot;,ctx)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># получаем доступ к текущему документу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">model = desktop.getCurrentComponent()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># получаем доступ к свойству документа text</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">text = model.Text</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># создаем курсор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">cursor = text.createTextCursor()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># вставляем текст в документ</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">text.insertString(cursor, &quot;Hello, World!&quot;, 0)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># В случае, если последний вызов является асинхронным (в нашем случае это insertString),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># нужно синхронизировать remote-bridge кэш перед тем, как питон завершит процесс.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># Иначе достижение результата асинхронным вызовом не гарантировано.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># Делаем это посредством &quot;бесполезного&quot; чтения свойства ServiceManager,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># что является синхронным вызовом, который приводит к автоматической синхронизации кэша.</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">ctx.ServiceManager</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Чтобы вышеприведённый скрипт сработал, OOo должен быть запущен в &quot;слушающем&quot; режиме с помощью примерно такой команды: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">soffice &quot;-accept=socket,host=localhost,port=2002;urp;&quot;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Кроме того, должен быть открыт текстовый документ Writer (можно добавить параметр -writer в командную строку). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Скрипт вставит в начало документа текст &quot;Hello, World!&quot;. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>