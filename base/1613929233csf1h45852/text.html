<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://gist.github.com/Titiaiev/dcb7298389d1276b823bbc96e29f940d"><span style=" text-decoration: underline; color:#0000ff;">https://gist.github.com/Titiaiev/dcb7298389d1276b823bbc96e29f940d</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Основы BASH. Часть 2 </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/linux/"><span style=" text-decoration: underline; color:#0000ff;">Настройка Linux</span></a> </li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Tutorial </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-content-body"></a>Основы BASH. Часть 2.<br />Извиняюсь за такую большую задержку между статьями, но сессия дает о себе знать в самый неподходящий момент :)<br />Всем спасибо за замечания, критику и дополнения, которые были озвучены в комментариях к прошлой <a href="http://habrahabr.ru/blogs/linux/47163/"><span style=" text-decoration: underline; color:#0000ff;">статье</span></a>.<br />Эта часть, как и обещал, будет посвящена циклам, математическим операциям и использованию внешних команд.<br />Начнем.<br /><a name="habracut"></a><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Циклы. Цикл for-in.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Оператор for-in предназначен для поочередного обращения к значениям перечисленным в списке. Каждое значение поочередно в списке присваивается переменной.<br />Синтаксис следующий:<br /><span style=" font-family:'Courier New';">for переменная in список_значений<br />do<br />команды<br />done<br /></span><br />Рассмотрим небольшой пример:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">#!/bin/bash<br />for i in 0 1 2 3 4 #переменной $i будем поочередно присваивать значения от 0 до 4 включительно<br />do<br />echo &quot;Console number is $i&quot; &gt;&gt; /dev/pts/$i #Пишем в файл /dev/pts/$i(файл виртуального терминала) строку &quot;Console number is $i&quot;<br />done #цикл окончен<br />exit 0<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />После выполнения примера в первых 5 виртуальных консолях(терминалах) появится строка с её номером. В переменную $i поочередно подставляются значения из списка и в цикле идет работа со значением этой переменной<br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Циклы. Цикл while.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Цикл while сложнее цикла for-in и используется для повторения команд, пока какое-то выражение истинно( код возврата = 0).<br />Синтаксис оператора следующий:<br /><span style=" font-family:'Courier New';">while выражение или команда возвращающая код возврата<br />do<br />команды<br />done<br /></span><br />Пример работы цикла рассмотрим на следующем примере:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">#!/bin/bash<br />again=yes #присваиваем значение &quot;yes&quot; переменной again<br />while [ &quot;$again&quot; = &quot;yes&quot; ] #Будем выполнять цикл, пока $again будет равно &quot;yes&quot;<br />do<br />echo &quot;Please enter a name:&quot;<br />read name<br />echo &quot;The name you entered is $name&quot;<br /><br />echo &quot;Do you wish to continue?&quot;<br />read again<br />done<br />echo &quot;Bye-Bye&quot;<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />А теперь результат работы скрипта:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">ite@ite-desktop:~$ ./bash2_primer1.sh<br />Please enter a name:<br />ite<br />The name you entered is ite<br />Do you wish to continue?<br />yes<br />Please enter a name:<br />mihail<br />The name you entered is mihail<br />Do you wish to continue?<br />no<br />Bye-Bye<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br />Как видим цикл выполняется до тех пор, пока мы не введем что-то отличное от «yes». Между do и done можно описывать любые структуры, операторы и т.п., все они будут выполнятся в цикле.Но следует быть осторожным с этим циклом, если вы запустите на выполнение в нём какую-либо команду, без изменения переменной выражения, вы можете попасть в бесконечный цикл.<br />Теперь об условии истинности. После while, как и в условном операторе if-then-else можно вставлять любое выражение или команду, которая возвращает код возврата, и цикл будет исполнятся до тех пор, пока код возврата = 0! Оператор &quot;[&quot; аналог команды test, которая проверяет истинность условия, которое ей передали.<br /><br />Рассмотрим еще один пример, я взял его из книги Advanced Bash Scripting. Уж очень он мне понравился :), но я его немного упростил. <span style=" font-weight:600;">В этом примере мы познакомимся с еще одним типом циклов UNTIL-DO</span>. Эта практически полный аналог цикла WHILE-DO, только выполняется пока какое-то выражение ложно.<br />Вот пример:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">#!/bin/bash<br />echo &quot;Введите числитель: &quot;<br />read dividend<br />echo &quot;Введите знаменатель: &quot;<br />read divisor<br /><br />dnd=$dividend #мы будем изменять переменные dividend и divisor,<br />#сохраним их знания в других переменных, т.к. они нам<br />#понадобятся<br />dvs=$divisor<br />remainder=1<br /><br />until [ &quot;$remainder&quot; -eq 0 ]<br />do<br />let &quot;remainder = dividend % divisor&quot;<br />dividend=$divisor <br />divisor=$remainder<br />done <br /><br />echo &quot;НОД чисел $dnd и $dvs = $dividend&quot; <br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Результат выполнения скрипта:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">ite@ite-desktop:~$ ./bash2_primer3.sh<br />Введите числитель:<br />100<br />Введите знаменатель:<br />90<br />НОД чисел 100 и 90 = 10<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /><br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Математические операции</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Команда let.<br />Команда let производит арифметические операции над числами и переменными.<br />Рассмотрим небольшой пример, в котором мы производим некоторые вычисления над введенными числами:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">#!/bin/bash<br />echo &quot;Введите a: &quot;<br />read a<br />echo &quot;Введите b: &quot;<br />read b<br /><br />let &quot;c = a + b&quot; #сложение<br />echo &quot;a+b= $c&quot;<br />let &quot;c = a / b&quot; #деление<br />echo &quot;a/b= $c&quot;<br />let &quot;c &lt;&lt;= 2&quot; #сдвигает c на 2 разряда влево<br />echo &quot;c после сдвига на 2 разряда: $c&quot;<br />let &quot;c = a % b&quot; # находит остаток от деления a на b<br />echo &quot;$a / $b. остаток: $c &quot;<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Результат выполнения:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">ite@ite-desktop:~$ ./bash2_primer2.sh<br />Введите a:<br />123<br />Введите b:<br />12<br />a+b= 135<br />a/b= 10<br />c после сдвига на 2 разряда: 40<br />123 / 12. остаток: 3<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Ну вот, как видите ничего сложного, список математических операций стандартный:<br />+ — сложение<br />— — вычитание<br />* — умножение<br />/ — деление<br />** — возведение в степень<br />% — модуль(деление по модулю), остаток от деления<br />let позволяет использовать сокращения арифметических команд, тем самым сокращая кол-во используемых переменных. Например: a = a+b эквивалентно a +=b и т.д<br /></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Работа с внешними программами при написании shell-скриптов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Для начала немного полезной теории.<br /></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:small; font-weight:600;">Перенаправление потоков.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />В bash(как и многих других оболочках) есть встроенные файловые дескрипторы: 0 (stdin), 1 (stdout), 2 (stderr).<br />stdout — Стандартный вывод. Сюда попадает все что выводят программы<br />stdin — Стандартный ввод. Это все что набирает юзер в консоли<br />stderr — Стандартный вывод ошибок. <br />Для операций с этими дескрипторами, существуют специальные символы: &gt; (перенаправление вывода), &lt; (перенаправление ввода). Оперировать ими не сложно. Например:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">cat /dev/random &gt; /dev/null</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">перенаправить вывод команды cat /dev/random в /dev/null (абсолютно бесполезная операция :)) ) или<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">ls -la &gt; listing</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">записать в файл listing содержание текущего каталога (уже полезней)<br />Если есть необходимость дописывать в файл(при использовании &quot;&gt;&quot; он заменятеся), необходимо вместо &quot;&gt;&quot; использовать &quot;&gt;&gt;&quot;<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">sudo &lt; my_password</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">после просьбы sudo ввести пароль, он возьмется из файла my_password, как будто вы его ввели с клавиатуры.<br />Если необходимо записать в файл только ошибки, которые могли возникнуть при работе программы, то можно использовать:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">./program_with_error 2&gt; error_file</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">цифра 2 перед &quot;&gt;&quot; означает что нужно перенаправлять все что попадет в дескриптор 2(stderr).<br />Если необходимо заставить stderr писать в stdout, то это можно можно след. образом:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">./program_with_error 2&gt;&amp;1</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">символ &quot;&amp;&quot; означает указатель на дескриптор 1(stdout)<br />(Поумолчанию stderr пишет на ту консоль, в котрой работает пользователь(вренее пишет на дисплей)).<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:small; font-weight:600;">2.Конвееры.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Конвеер — очень мощный инструмент для работы с консолью Bash. Синтаксис простой:<br /><span style=" font-family:'Courier New';">команда1 | команда 2 </span>— означает, что вывод команды 1 передастся на ввод команде 2<br />Конвееры можно группировать в цепочки и выводить с помощью перенаправления в файл, например:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">ls -la | grep «hash» |sort &gt; sortilg_list</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">вывод команды ls -la передается команде grep, которая отбирает все строки, в которых встретится слово hash, и передает команде сортировке sort, которая пишет результат в файл sorting_list. Все довольно понятно и просто.<br /><br />Чаще всего скрипты на Bash используются в качестве автоматизации каких-то рутинных операций в консоли, отсюда иногда возникает необходимость в обработке stdout одной команды и передача на stdin другой команде, при этом результат выполнения одной команды должен быть неким образом обработан. В этом разделе я постораюсь объяснить основные принципы работы с внешними командами внутри скрипта. Думаю что примеров я привел достаточно и можно теперь писать только основные моменты.<br /><br /></p>
<p style=" margin-top:12px; margin-bottom:4px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:small; font-weight:600;">1. Передача вывода в переменную.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Для того чтобы записать в переменную вывод какой-либо команды, достаточно заключить команду в `` ковычки, например<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">a = `echo &quot;qwerty&quot;`<br />echo $a<br /></span><br />Результат работы: qwerty</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Однако если вы захотите записать в переменную список директорий, то необходимо, должным образом обработать результат для помещения данных в переменную. Рассмотрим небольшой, пример:<br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New';">LIST=`find /svn/ -type d 2&gt;/dev/null| awk '{FS=&quot;/&quot;} {print $4}'| sort|uniq | tr '\n' ' '`<br />for ONE_OF_LIST in $LIST<br />do<br />svnadmin hotcopy /svn/$ONE_OF_LIST /svn/temp4backup/$ONE_OF_LIST<br />done<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br />Здесь мы используем цикл for-do-done для архивирование всех директорий в папке /svn/ с помощью команды svnadmin hotcopy(что в нашем случае не имеет никого значения, просто как пример). Наибольшй интерес вызывает строка: <span style=" font-family:'Courier New';">LIST=`find /svn/ -type d 2&gt;/dev/null| awk '{FS=&quot;/&quot;} {print $4}'| sort|uniq | tr '\n' ' '`</span> В ней переменной LIST присваивается выполнение команды find, обработанной командами awk, sort, uniq,tr(все эти команды мы рассматривать не будем, ибо это отдельная статья). В переменной LIST будут имена всех каталогов в папке /svn/ пгомещенных в одну строку(для того чтобы её стравить циклу.<br /><br />Как видно, все не сложно, достаточно понять принцип и написать пару своих скриптов. В заключении статьи хочу пожелать удачи в изучении BASH и Linux в целом. Критика, как водится приветствуется. Следующая статья возможно будет посвещена использованию таких программ как sed, awk.<br /><br />Статьи на <a href="http://unix-admin.su"><span style=" text-decoration: underline; color:#0000ff;">unix-admin.su</span></a> </p>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теги: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?q=%5Bbash%5D&amp;target_type=posts"><span style=" text-decoration: underline; color:#0000ff;">bash</span></a> </li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/search/?q=%5Blinux%5D&amp;target_type=posts"><span style=" text-decoration: underline; color:#0000ff;">linux</span></a> </li></ul>
<p style=" margin-top:8px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хабы: </p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://habr.com/ru/hub/linux/"><span style=" text-decoration: underline; color:#0000ff;">Настройка Linux</span></a><span style=" color:#000000;"> </span></li></ul></body></html>