<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Working with Microsoft Excel tables in VBA</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:transparent;">This blog post will be based on working with tables via VBA. They present some unique issues, which has to do with how their structured in the object model. Good or bad, it’s what we have. These are based on my trial and errors, so hopefully this will help somebody out there. That being said I consider this an intermediate level post.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If you’re not up to speed with tables, take a look at these:</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelandaccess.wordpress.com/2013/01/07/why-you-should-use-structured-references-in-tables/"><span style=" text-decoration: underline; color:#0000ff;">http://excelandaccess.wordpress.com/2013/01/07/why-you-should-use-structured-references-in-tables/</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">When looking for information about tables, or adding/deleting data, it can be tricky. Here are some pieces of information to keep in mind, which isn’t very obvious, but are cornerstones in working with tables in VBA:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Deleting the DataBodyRange (data portion of a table) will set it to Nothing *</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If table parts (i.e. header, totals row) aren’t showing, attempting access will result in an error</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Accessing the straight Range of a table includes all visible parts (i.e. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:transparent;">[#All]) </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Tables are ListObjects * </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If you’ve worked with tables in VBA, you may have noticed that when deleting a table’s entire data body, you are still left with a single, blank row. This is because you must have at least one row of data for the table to still be “alive”. No data rows, no table. You can hide the header and totals row, but you can’t get rid of the body. This presents some interesting coding when working with tables, and can be problematic, aka headache-inducing.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">* Check the links at the bottom of the post for additional information on these topics.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Here are some VBA examples for doing various things with tables in VBA. The file will be available (link at bottom of post) for download.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Common variables used throughout</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”text”] Public WS As Worksheet</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Public loSet As ListObject<br />Public loGet As ListObject<br />Public loTest As ListObject</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Public rCols As Range<br />Public rRows As Range<br />Public rBody As Range<br />Public rData As Range<br />Public rHeader As Range<br />Public rStart As Range</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Public iCol As Long<br />Public iRow As Long<br />Public iStep As Long<br />Public iLastRow As Long<br />Public iRowCnt As Long<br />Public iColCnt As Long</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Public sMsg As String</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Public Const sSheetName As String = “Sheet1”<br />Public Const sTableName As String = “Table1”<br />Public Const sTableName2 As String = “Table2”<br />Public Const NL As String = vbNewLine<br />Public Const DNL As String = vbNewLine &amp; vbNewLine[/sourcecode]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">As you can see I used some constants for testing in this specific workbook. Change these variables for testing in your environment. I tried to keep the naming convention simple.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Getting information from your tables</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">When working with tables via VBA it’s important to know how to look at them, and thus where to go for information. These are some examples of how to get dimension(s) information from your tables.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Listing columns</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This will step through a table and list the column headers in a message box, as well as the Immediate window in the Visual Basic Editor (Ctrl + G to show it).</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub Table_ListColumns()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">On Error Resume Next<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loTest = WS.ListObjects(sTableName)<br />On Error GoTo 0</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If WS Is Nothing Or loTest Is Nothing Then<br />MsgBox “There was an error setting the variables.”, vbInformation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">sMsg = vbNullString<br />For iStep = 1 To loTest.ListColumns.Count<br />Debug.Print loTest.ListColumns.Item(iStep).Name<br />sMsg = sMsg &amp; NL &amp; iStep &amp; “) ” &amp; loTest.ListColumns(iStep)<br />Next iStep<br />sMsg = “‘” &amp; loTest.Name &amp; “‘ column headers:” &amp; NL &amp; sMsg</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">MsgBox sMsg, vbOKOnly, “COLUMN HEADERS”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Column count</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This will not loop through the table, but give a straight count of columns, along with which/where the start/end columns are.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub Table_CountColumns()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">On Error Resume Next<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loTest = WS.ListObjects(sTableName)<br />On Error GoTo 0</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If WS Is Nothing Or loTest Is Nothing Then<br />MsgBox “There was an error setting the variables.”, vbInformation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">sMsg = “There are ” &amp; loTest.ListColumns.Count &amp; ” columns in ‘” &amp; sTableName &amp; “‘.”<br />sMsg = sMsg &amp; DNL &amp; “Starting on column ” &amp; loTest.ListColumns(1).Range.Column &amp; ” (” &amp; loTest.ListColumns(1) &amp; “)”<br />sMsg = sMsg &amp; NL &amp; “Ending on column ” &amp; loTest.ListColumns(loTest.ListColumns.Count).Range.Column &amp; ” (” &amp; loTest.ListColumns(loTest.ListColumns.Count) &amp; “)”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">MsgBox sMsg, vbInformation, UCase(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Row count</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Again, no loop, just find out how many rows are in the table and where they are.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub Table_CountRows()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">On Error Resume Next<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loTest = WS.ListObjects(sTableName)<br />On Error GoTo 0</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If WS Is Nothing Or loTest Is Nothing Then<br />MsgBox “There was an error setting the variables.”, vbInformation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">sMsg = “There are ” &amp; loTest.ListRows.Count &amp; ” rows in ‘” &amp; sTableName &amp; “‘.”<br />sMsg = sMsg &amp; DNL &amp; “Starting on row ” &amp; loTest.ListRows(1).Range.Row<br />sMsg = sMsg &amp; NL &amp; “Ending on row ” &amp; loTest.ListRows(loTest.ListRows.Count).Range.Row</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">MsgBox sMsg, vbInformation, UCase(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Resizing Tables</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Resize table based on original</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This will basically clear out the manual data and leave the formulas. It gets a row count and uses that to insert rows to its original size. Please note these focus on resizing rows programmatically, not columns, which can be trickier.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub ResizeTableRows()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Ensure the table has a data range<br />If loSet.DataBodyRange Is Nothing Then<br />MsgBox “The source table has no data stucture.”, vbExclamation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Get the number of rows in the table<br />iRowCnt = loSet.ListRows.Count</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Delete destination table data<br />If Not loSet.DataBodyRange Is Nothing Then<br />loSet.DataBodyRange.Delete<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Resize to source table size<br />For iStep = 1 To iRowCnt<br />loSet.ListRows.Add iStep<br />Next iStep</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘///////////////////////////////////////////////////////////////////////////<br />‘/// At this point the table is restructured, and the formulas which were<br />‘/// there are re-populated<br />‘///////////////////////////////////////////////////////////////////////////</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Resize table based on another tables size (in rows)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This utilizes two tables. The second table is only used for its row size and makes the first table the same size. It deletes the DataBodyRange as well, so all manual data will be erased, leaving only formulas.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub ResizeTableRowsBasedOnAnother()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set two tables, one to set (destination)<br />‘/// and one to resize from (source)<br />Set loSet = WS.ListObjects(sTableName)<br />Set loGet = WS.ListObjects(sTableName2)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Delete destination table data<br />If Not loSet.DataBodyRange Is Nothing Then<br />loSet.DataBodyRange.Delete<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Ensure source table has data range<br />If loGet.DataBodyRange Is Nothing Then<br />MsgBox “The source table has no data stucture.”, vbExclamation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Resize to source table size<br />For iStep = 1 To loGet.ListRows.Count<br />loSet.ListRows.Add iStep<br />Next iStep</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘///////////////////////////////////////////////////////////////////////////<br />‘/// At this point the table is restructured, and the formulas which were<br />‘/// there are re-populated<br />‘///////////////////////////////////////////////////////////////////////////</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Resize table columns</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This example will add a single column. While I am very hesitant to code something like this, here is an example. While it’s easier to add rows, adding columns present some unique problems, which include:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Where should the columns be inserted?</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Without proper absolute structured formula referencing, this could throw off formulas</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ideally no data should be to the right of the table, so an error won’t be thrown.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub ResizeTableCols()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Ensure the table has a data range<br />If loSet.DataBodyRange Is Nothing Then<br />MsgBox “The source table has no data stucture.”, vbExclamation, “ERROR!”<br />Exit Sub<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Get the number of columns in the table, add one<br />iColCnt = loSet.ListColumns.Count + 1</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Delete destination table data<br />If Not loSet.DataBodyRange Is Nothing Then<br />loSet.DataBodyRange.Delete<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Resize to source table size<br />On Error Resume Next<br />For iStep = 1 To iColCnt<br />If loSet.ListColumns(iStep) Is Nothing Then<br />Err.Clear<br />loSet.ListColumns.Add<br />If Err.Number &gt; 0 Then<br />‘something prevented the column from being added<br />Exit For<br />End If<br />End If<br />Next iStep<br />On Error GoTo 0</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘///////////////////////////////////////////////////////////////////////////<br />‘/// At this point the table is restructured, and the formulas which were<br />‘/// there are re-populated<br />‘///////////////////////////////////////////////////////////////////////////</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Select table parts</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Table ranges</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">It’s always best to work with actual table range referernces. While you can access the range object of the underlying worksheet, it gets tough. This shows an example.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub ListTableParts()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If loSet.DataBodyRange Is Nothing Then<br />If MsgBox(“Data range has been deleted. Create now?”, vbYesNo, “ERROR!”) = vbYes Then<br />loSet.ListRows.Add 1<br />End If<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Using standard table referencing objects<br />sMsg = “Standard table referencing” &amp; DNL<br />If Not loSet.DataBodyRange Is Nothing Then<br />sMsg = sMsg &amp; “Data range: ” &amp; loSet.DataBodyRange.Address(0, 0) &amp; NL<br />End If<br />If Not loSet.HeaderRowRange Is Nothing Then<br />sMsg = sMsg &amp; “Header range: ” &amp; loSet.HeaderRowRange.Address(0, 0) &amp; NL<br />Else<br />sMsg = sMsg &amp; “Header range: (none set)” &amp; NL<br />End If<br />If Not loSet.TotalsRowRange Is Nothing Then<br />sMsg = sMsg &amp; “Totals range: ” &amp; loSet.TotalsRowRange.Address(0, 0) &amp; NL<br />Else<br />sMsg = sMsg &amp; “Totals range: (none set)”<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Using range referencing objects<br />sMsg = sMsg &amp; DNL &amp; “Range referencing” &amp; NL<br />If Not loSet.DataBodyRange Is Nothing Then<br />sMsg = sMsg &amp; “Data range: ” &amp; loSet.Range(1, 1).Address(0, 0) &amp; “:” &amp; loSet.Range(loSet.Range.Rows.Count, loSet.Range.Columns.Count).Address(0, 0) &amp; NL<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">MsgBox sMsg, vbInformation, “INFO”</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Select table Header</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This selects just the header range of the table, if it is showing. If it’s not showing the user gets the option to show it at that time.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub SelectHeader()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If Not loSet.HeaderRowRange Is Nothing Then<br />loSet.HeaderRowRange.Select<br />Else<br />If MsgBox(“Header row isn’t showing. Show now?”, vbYesNo, “ERROR!”) = vbYes Then<br />loSet.ShowHeaders = True<br />End If<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Select table data</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This selects just the data range of the table, if it is not deleted. If it’s not there the user gets the option to add it at that time.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">NOTE: Adding a data body (DataBodyRange) to a table is as simple as inserting a row. This is quite a useful trick when working with tables via VBA.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub SelectData()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If Not loSet.DataBodyRange Is Nothing Then<br />loSet.DataBodyRange.Select<br />Else<br />If MsgBox(“Data range has been deleted. Create now?”, vbYesNo, “ERROR!”) = vbYes Then<br />loSet.ListRows.Add 1<br />End If<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Select table Totals row</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This selects just the totals row range of the table, if it is showing. If it’s not showing the user gets the option to show it at that time.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub SelectTotalRow()</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If Not loSet.TotalsRowRange Is Nothing Then<br />loSet.TotalsRowRange.Select<br />Else<br />If MsgBox(“Totals row isn’t showing. Show now?”, vbYesNo, “ERROR!”) = vbYes Then<br />loSet.ShowTotals = True<br />End If<br />End If</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub[/sourcecode]</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Show table parts</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">This routine has a Boolean (True/False) variable passed to it to turn on or off all table parts (non-formatting)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">[sourcecode language=”vb”] Sub ShowTableParts(Optional ByVal bState As Boolean = True)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">‘/// Set misc variables<br />Set WS = ThisWorkbook.Worksheets(sSheetName)<br />Set loSet = WS.ListObjects(sTableName)</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">loSet.ShowTotals = bState<br />loSet.ShowHeaders = bState<br />If bState = True Then loSet.ShowAutoFilter = bState</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">End Sub [/sourcecode]</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Note that the ShowAutoFilter portion only runs if a True variable is passed (turning properties on). This is because if you turn off the header row, there’s nothing to filter on, so there’s no need to worry about it.</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Summary</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The important parts of the object model to look at with respect to tables are:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ListObject</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DataBodyRange</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">HeaderRowRange</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">TotalsRowRange</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ListRows</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ListColumns</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">There are other things you can do with tables via VBA, this certainly isn’t the complete guide. Some of those things include:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Work with slicers *</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Unlist it (convert to standard range)</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Set style/formatting options</li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:x-large; font-weight:600;">Additional information</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Jan Karel Pieterse: <a href="http://www.jkp-ads.com/articles/Excel2007Tables.asp"><span style=" text-decoration: underline; color:#0000ff;">http://www.jkp-ads.com/articles/Excel2007Tables.asp</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Colin Legg: <a href="http://colinlegg.wordpress.com/2012/09/01/clearing-excel-tables/"><span style=" text-decoration: underline; color:#0000ff;">http://colinlegg.wordpress.com/2012/09/01/clearing-excel-tables/</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Sample file for download: <a href="http://excelandaccess.files.wordpress.com/2013/01/tblexample.xlsb"><span style=" text-decoration: underline; color:#0000ff;">tblExample</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">File tested and works in Excel 2010 and 2013 without issue.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A special thanks to Chris “Smitty” Smith, Christopher T. Fennell and Colin Legg, equally for the direction, support and inspiration for this blog post. Thank you.</p></body></html>