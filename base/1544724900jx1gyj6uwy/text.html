<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Загрузка из Excel  в MS SQL Server (несколько способов)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-body-8367955877458638644"></a>Несколько примеров работы из MS SQL Server  с таблицами формата Excel(.xls,.xlsx):</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="more"></a><span style=" font-weight:600;">1</span><span style=" font-weight:600;">)Сиспользованием функции OPENROWSET или с OPENDATASOURCE:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">*</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">FROM</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">OPENROWSET</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'MSDASQL'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'Driver={Microsoft Excel Driver (*.xls)};</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">DBQ=[C:\gr_otchet.xls]'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'SELECT * FROM [Sheet1$A8:D10000]'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример для OPENDATASOURCEиз BOL:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">SELECT</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">*</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">FROM</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">OPENDATASOURCE</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'Microsoft.Jet.OLEDB.4.0'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'DataSource=C:\DataFolder\Documents\TestExcel.xls;Extended Properties=EXCEL 5.0'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">)...</span><span style=" font-family:'Courier New'; font-size:10pt; color:#008080;">[Sheet1$]</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Одна израспространенных  проблем, это отсутствиедрайверов под х64 платформу, или установка х32 битных под х64 систему. Например,драйверов Microsoft.Jet.OleDB нет 64 битных,в этом случае  можно использовать другие драйвера, к примеру <a href="http://www.microsoft.com/download/en/details.aspx?id=13255"><span style=" text-decoration: underline; color:#0000ff;">Microsoft.ACE.OLEDB.12.0</span></a>.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Не забудьте только проПримечание из  BOL:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ФункцияOPENROWSET  или  OPENDATASOURCE может быть использованадля доступа к удаленным данным из источников данных OLE DB только в том случае,если для заданного поставщика параметр реестра DisallowAdhocAccess явноустановлен в 0 и включен параметр Ad Hoc Distributed Queries расширеннойнастройки. Если эти параметры не установлены, поведение по умолчанию запрещаетнерегламентированный доступ.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если параметрAd Hoc Distributed Queries выключен, то  об будет информационное сообщение. Включениепараметра осуществляется через хранимую процедуру <span style=" font-weight:600;">sp_configure. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#800000;">sp_configure</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'Ad Hoc Distributed Queries'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt;"> 1</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">RECONFIGURE</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">2) Второй спосб через Linkedserverи ODBC драйвер.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1-ый способхорошо, когда необходимо использовать разово, для частого и широкоиспользования лучше использовать технологию связанного сервера(Linked Server)</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для этогонеобходимо установить на сервере MS SQL Server <a href="http://www.microsoft.com/download/en/details.aspx?id=23734"><span style=" text-decoration: underline; color:#0000ff;">ODBC драйвер а</span></a> для Excel, затем создать источникданных( Администрирование -&gt;Источники данных)</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://2.bp.blogspot.com/-ik5-HjXzlhs/TzlaFFk8dfI/AAAAAAAAACM/sbdEvBA2PPQ/s1600/1-q.PNG"><img src="1.png" width="320" height="257" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Указывает имя источника данных,версию Excel и самфайл.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сохраняем источник.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого создаем связанныйсервер LinkedServed (связанныйсервер):</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://1.bp.blogspot.com/-NJdlQQwt3vc/TzlaGIcAOuI/AAAAAAAAACY/eemWoj2MGjI/s1600/3-1.JPG"><img src="2.png" width="320" height="177" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Указываем имя нашего  связанного сервера и имя созданного намираннего ODBC источника.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сохраняем.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Теперь можно выполнять запросы кнашему связанному серверу, к примеру:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">select</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">*</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">from</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">openquery</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#008080;">excel</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'select * from [sheet1$]'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">) – получение всех данныз из экселя</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">select</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">*</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">from</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">openquery</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#008080;">excel</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'select * from[Sheet1$A10:D2]'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">) – получение данных диапозона </span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">$A10:D2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">select</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">*</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">from</span><span style=" font-family:'Courier New'; font-size:10pt;"> </span><span style=" font-family:'Courier New'; font-size:10pt; color:#0000ff;">openquery</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">(</span><span style=" font-family:'Courier New'; font-size:10pt; color:#008080;">excel</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">,</span><span style=" font-family:'Courier New'; font-size:10pt; color:#ff0000;">'select * from[Sheet1$A10:D]'</span><span style=" font-family:'Courier New'; font-size:10pt; color:#808080;">) – получение данных диапозона с A10:D доконца файла.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">3) Еще одни,способ, когда необходим импорт разово, </span>то можно использовать «SQL Server Import and Export Wizard»: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выделяем БД,  правая кнопка, Задачи, Выбираем пункт Импортили Экспорт:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбираем источник данных, нашфайл Excel, версию Excel-я. :</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://3.bp.blogspot.com/-i98LC4iKYZI/TzlaGavu0MI/AAAAAAAAACc/zK0K4bH_f8A/s1600/4-1.JPG"><img src="3.png" width="318" height="320" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбираем кудакопировать данные, указываем таблицу назначение .</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этогоможно пакет запустить немедленно или его сохранить для дальнейшегоиспользования.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">4) Кстати, 4 способ, это как раз создание пакета SSIS в Microsoft Visual Studi</span>o, результатом котороготак же будет пакет, похожий на то, что было создано в варианте 3</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Делается онпросто</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбирается Элемент потокауправления</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="4.png"><img src="4.png" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Затем выбирается источник исервер назначения:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="5.png"><img src="5.png" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В источнике соединений создаетсяновое соединение с нашим файлом Excel,в  Назначение указываем наш MS SQL Server, указываем таблицу,сопоставляем столбцы:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://2.bp.blogspot.com/-P2_zA20gWg0/TzlaHnIcBDI/AAAAAAAAACs/FO2Q6QL4zDM/s1600/6-1.JPG"><img src="6.png" width="320" height="215" /></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого сохраняем пакет, иего запускаем.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пакет создали  и должен работать.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Удачи .</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Автор:<a href="https://www.blogger.com/profile/17569018659041670317"><span style=" text-decoration: underline; color:#0000ff;">Вячеслав</span></a>на<a href="http://dbasimple.blogspot.com/2012/02/excel-ms-sql-server.html"><span style=" text-decoration: underline; color:#0000ff;">22:49</span></a><a href="https://www.blogger.com/email-post.g?blogID=5048447696442176834&amp;postID=8367955877458638644"><img src="7.png" width="18" height="13" /></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="___plusone_0"></a>Ярлыки:<a href="http://dbasimple.blogspot.com/search/label/Excel"><span style=" text-decoration: underline; color:#0000ff;">Excel</span></a>  <a href="http://dbasimple.blogspot.com/search/label/Linked%20Server"><span style=" text-decoration: underline; color:#0000ff;">Linked Server</span></a> <a href="http://dbasimple.blogspot.com/search/label/OPENDATASOURCE"><span style=" text-decoration: underline; color:#0000ff;">OPENDATASOURCE</span></a> <a href="http://dbasimple.blogspot.com/search/label/OPENROWSET"><span style=" text-decoration: underline; color:#0000ff;">OPENROWSET</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-weight:600;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>