<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Python: модуль для работы с WMI</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">This text is a rather free translation of the materials of the Tim Golden's site </span><a href="http://tgolden.sc.sabren.com/index.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/index.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">, namely: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tgolden.sc.sabren.com/python/wmi.html"><span style=" font-size:small; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi.html</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tgolden.sc.sabren.com/python/wmi-tutorial.html"><span style=" font-size:small; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi-tutorial.html</span></a><span style=" font-size:small;"> </span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">See also WMI Cookbook (</span><a href="http://tgolden.sc.sabren.com/python/wmi_cookbook.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi_cookbook.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">), that has not been included here. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">This material has been put here with the author's consent. </span></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">Данный текст является достаточно вольным переводом материалов сайта </span><a href="http://tgolden.sc.sabren.com/index.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/index.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">, а именно: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;" style=" margin-top:5px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tgolden.sc.sabren.com/python/wmi.html"><span style=" font-size:small; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi.html</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://tgolden.sc.sabren.com/python/wmi-tutorial.html"><span style=" font-size:small; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi-tutorial.html</span></a><span style=" font-size:small;"> </span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">Смотрите также &quot;WMI Cookbook&quot; (&quot;поваренная книга WMI&quot;), которая здесь не отражена: </span><a href="http://tgolden.sc.sabren.com/python/wmi_cookbook.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi_cookbook.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">Данный материал размещён здесь с согласия автора, Тима Гольдена (Tim Golden). </span></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Технология </span><a href="http://www.script-coding.com/WMI.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">WMI (Windows Management Instrumentation)</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> является реализацией от Microsoft модели управления предприятием на базе Web (Web-Based Enterprise Management, WBEM) с поддержкой схемы Common Information Model (CIM). Естественно, этот продукт от Microsoft использует DCOM как основной стержень, и поэтому, с точки зрения Питона, нуждается, например, в </span><a href="http://starship.python.net/crew/mhammond/"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">Win32 Extensions</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> от Марка Хаммонда (Mark Hammond) или в любом другом коде, который сделает ту же самую работу. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы установили вышеупомянутые расширения, ваша работа почти сделана. Инструментарий WMI - это иерархия объектов с некоторым количеством самодокументирования. Большинство примеров, на которые вы натолкнётесь, нацелено в VBS или WSH, но они адаптируются с достаточной лёгкостью. Однако... Как только вы перестаёте мочить пальцы ног в краешке воды и начинаете погружаться в тёмные воды, вы обнаруживаете, что не все вещи всегда так уж прямолинейны. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Модуль, который предлагается здесь, делает некоторое количество &quot;грязной&quot; работы, чтобы облегчить вам жизнь. Вы всегда имеете доступ к основному WMI COM-объекту в случае, если вам нужно немного &quot;попачкать руки&quot;, а для решения насущных задач, с которыми приходится сталкиваться ежедневно, модуль может быть весьма удобен. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Copyright и лицензирование</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">© </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Тим Гольден (Tim Golden)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, 5 июня 2003 г. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Сайт автора: </span><a href="http://tgolden.sc.sabren.com/index.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/index.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Модуль лицензируется согласно GPL-совместимой лицензии MIT: </span><a href="http://www.opensource.org/licenses/mit-license.php"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://www.opensource.org/licenses/mit-license.php</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Пример</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for s in c.Win32_Service ():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    if s.State == 'Stopped':</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print s.Caption, s.State</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Загрузка</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Вы можете скачать модуль со странички автора: </span><a href="http://tgolden.sc.sabren.com/python/wmi.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://tgolden.sc.sabren.com/python/wmi.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. Там же вы найдёте историю версий (в т.ч. самую свежую версию из репозитория) и документацию на английском языке, а также некоторые замечания относительно использования этого модуля в службах Windows и при многопоточном программировании в Python. Кроме того, вы можете скачать модуль и прямо здесь: <br /></span></p>
<table border="1" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" width="100%" cellspacing="0" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.script-coding.com/Python/wmi-1.3.1.zip"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">wmi-1.3.1.zip</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> (26 699 байт)</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Модуль wmi, инсталлятор, readme и документация на английском языке. Версия 1.3.1 от 5 июня 2007 г.<br />Внимание! Возможно, на сайте автора вы сможете найти более свежую версию.</span></p></td></tr></table>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Установка</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Распакуйте скачанный архив в удобное вам место и выполните команду наподобие следующей: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">python setup.py install</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<hr />
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Введение в использование модуля</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">О том, что из себя в принципе представляет WMI, вы можете прочитать здесь: </span><a href="http://www.script-coding.com/WMI.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">Введение в Windows Management Instrumentation (WMI)</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Дальнейшее изложение использует язык программирования Python и предполагает, что вы загрузили и установили сам Python, необходимые расширения pywin32 и описываемый здесь WMI модуль для Python. Python может использовать WMI посредством пакетов, поддерживающих COM, например, </span><a href="http://sf.net/projects/pywin32"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">Win32 Extensions</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> от Марка Хаммонда (Mark Hammond) или </span><a href="http://sf.net/projects/comtypes"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">comtypes</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> от Томаса Хеллера (Thomas Heller). Данный WMI модуль предполагает, что необходимые расширения pywin32 присутствуют, и предоставляет немного более благоприятный интерфейс для Python, чем иногда &quot;грязный&quot; скриптовый API WMI. (</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">Примечание переводчика: для работы данного модуля вполне достаточно стандартной установки </span><a href="http://activestate.com/Products/ActivePython/"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic; text-decoration: underline; color:#0000ff;">ActivePython</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-style:italic;">.</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">) Примечание: этот модуль - только обёртка для функциональных возможностей pywin32, и если WMI под pywin32 кажется вам слишком медленным, этот модуль не будет работать быстрее. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Здесь не будет рассматриваться то, что вы можете сделать с WMI вообще, за исключением демонстрации небольшого количества функциональных возможностей в пределах описания модуля. В Интернете можно найти немало примеров работы с WMI (и вы сможете использовать большинство возможностей WMI, если будете пробовать достаточно целеустремлённо). </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В большинстве случаев вы просто подключаетесь к локальной машине со значениями по умолчанию: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы подключаетесь к другой машине, определите её имя как первый параметр: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(&quot;other_machine&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Выполнение запросов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Самая обычная вещь, которую вы будете делать с WMI - это получать информацию о различных частях вашей системы. Вы определяете, какой класс WMI опросить, и затем обращаетесь к нужному атрибуту WMI-объекта Python: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for os in c.Win32_OperatingSystem():</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print os.Caption</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">&quot;Какой WMI класс опросить&quot;, как было упомянуто выше - это далеко не всегда такой уж простой вопрос, как бы просто это не звучало. Однако, используя хороший поисковый сервер, вы можете быть в значительной степени уверены, что кто-нибудь где-нибудь уже сделал ту самую работу, которая вам нужна, хотя бы и на другом языке программирования. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Обратите внимание, что хотя как правило есть только одна операционная система, запрос к WMI всегда возвращает список, состоящий, возможно, из одного элемента. Элементы списка обёрнуты модулем Python для доступа к атрибутам. В данном случае класс </span><a href="http://msdn2.microsoft.com/en-us/library/aa394239.aspx"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">Win32_OperatingSystem</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> имеет несколько атрибутов, один из которых - Caption, который возвращает имя установленной операционной системы. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Мониторинг</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">WMI имеет концепцию событий. Есть два типа событий - встроенные и внешние, которые описаны ниже. Модуль Python делает различие между ними настолько прозрачным, насколько это возможно. Например, вы хотите отследить запуск новых процессов: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">process_watcher = c.Win32_Process.watch_for(&quot;creation&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    new_process = process_watcher()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print new_process.Caption</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">v1.3.1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. Если вы не определяете тип встроенного события, будет принято событие &quot;operation&quot;, которое вызывается при любом изменении объекта этого класса. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Обновление</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Некоторые (но ни в коем случае не все) классы WMI предоставляют возможность записи информации. Вы можете это проделать, устанавливая атрибуты как обычно в Python. Обратите внимание, что класс может позволить вам сделать это без выдачи каких-либо ошибок даже при том, что ничего полезного не произойдёт. Чтобы изменить отображаемое имя службы, например, вы должны вызвать метод Change. Вы можете без ошибки обновить атрибут displayName непосредственно, но это не будет иметь никакого эффекта. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Самый типичный случай, когда вы можете установить атрибут непосредственно - когда вы создаете абсолютно новый объект класса методом new. В том случае вы можете или установить все параметры как параметры вызова new, или определить их один за другим впоследствии. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Методы</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Некоторые классы WMI имеют методы для оперирования с ними. Вы можете вызывать их, как если бы они были обычными классами или методами объектов в Python. Начиная с версии </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">1.3.1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, могут быть установлены параметры; они должны быть именованными. Например, если вы хотите остановить службу RunAs (&quot;seclogon&quot;, вторичный вход в систему), вы можете написать: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for service in c.Win32_Service(Name=&quot;seclogon&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    result, = service.StopService()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    if result == 0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;Service&quot;, service.Name, &quot;stopped&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;Some problem&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    break</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">else:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;Service not found&quot;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<hr />
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Дополнительный материал</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Основы того, что может быть сделано модулем WMI, описаны выше, и это вероятно то, что нужно большинству людей. Однако в WMI есть много небольших тонкостей, и изучая какой-нибудь VBS-ориентированный пример где-нибудь в Интернете, вы можете раздумывать: &quot;И как же я сделаю это в Python?&quot;. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Расширенное подключение</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Функция connect (названная в нашем модуле как WMI) имеет довольно много параметров, большинство которых являются необязательными и могут безопасно игнорироваться. Большинство из их можно увидеть в документации Microsoft по WMI-моникерам </span><a href="http://www.microsoft.com/technet/scriptcenter/guide/sas_wmi_arib.mspx"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://www.microsoft.com/technet/scriptcenter/guide/sas_wmi_arib.mspx</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. Мы же опишем здесь только некоторые из них. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение к удалённому компьютеру</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Это самый обычный и наиболее простой необязательный параметр. Это - первый позиционный параметр или параметр &quot;computer&quot;. Вы можете подключиться к вашему собственному компьютеру, не задавая ничего, пустую строку, точку или имя компьютера любым способом, включая &quot;localhost&quot;. Но обычно достаточно не передавать параметр вообще. Чтобы подключиться к подсистеме WMI на компьютере с именем &quot;MachineB&quot;, можно написать: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(&quot;MachineB&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение к удалённому компьютеру под указанным пользователем</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Это - вторая самая обычная потребность, которая работает довольно просто, но с несколькими нюансами. Первый нюанс - это то, что независимо от того, насколько хитро вы попробуете всё запутать - вы не сможете подключиться к вашему собственному компьютеру этим путём. Второй - эта методика не всегда хорошо сочетается со многими уровнями безопасности WMI. Чтобы подключиться к машине с именем &quot;MachineB&quot; под именем пользователя &quot;fred&quot; с паролем &quot;secret&quot;, можно написать: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(&quot;MachineB&quot;, user=r&quot;MachineB\fred&quot;, password=&quot;secret&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение к указанному пространству имён</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">WMI классы организованы в иерархию пространств имён. Большинство полезных классов находится в пространстве имён cimv2, которое, как правило, является значением по умолчанию. Но дополнительные провайдеры WMI могут определять особые пространства имён, например MicrosoftIISv2 или DEFAULT/StdRegProv. Чтобы использовать пространство имён, отличное от значения по умолчанию (которое, кстати, может оказаться совсем не тем, что вам нужно!) определите параметр &quot;namespace&quot;. Все пространства имён начинаются с root, что не обязательно указывать, хотя, если вы хотите непосредственно определить пространство имён root, вы можете это сделать. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(namespace=&quot;WMI&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Указание полного моникера</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В некоторых случаях вы захотите указать полный моникер, например потому, что этот моникер довольно сложен, или потому, что вы хотите его &quot;вырезать и вставлять&quot; каким бы то ни было способом. В том случае передайте моникер как строку через параметр &quot;moniker&quot;: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(moniker=&quot;winmgmts:{impersonationLevel=impersonate,(LockMemory, !IncreaseQuota)}&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Подключение к указанному классу или объекту</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Особый случай полного моникера - это использование моникера, чтобы соединиться непосредственно с WMI классом или даже определенным объектом. Модуль обратит внимание, что моникер обращается к классу или объекту, и возвратит объект непосредственно, а не пространство имён. Любой путь объекта WMI может использоваться как моникер, чтобы восстановить его, например вот так можно подсоединиться непосредственно к классу Win32_LogicalDisk: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">logical_disk = wmi.WMI(moniker=&quot;//./root/cimv2:Win32_LogicalDisk&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В версии </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">1.3.1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> это теперь эквивалентно обращению к классу через обычный механизм, хотя это имеет применение главным образом внутри модуля и при переводе примеров, которые используют такую методику. Обращение к конкретному объекту аналогично и немного более полезно: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c_drive = wmi.WMI(moniker='//./root/cimv2:Win32_LogicalDisk.DeviceID=&quot;C:&quot;')</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Это тот же самый объект, который вы получили бы, запрашивая Win32_LogicalDisk в пространстве имён cimv2 с параметром DeviceID = &quot;C:&quot;, поэтому с точки зрения модуля это не слишком полезно. Однако, это довольно обычное использование в примерах на VBS в Интернете, и немного упрощает перевод. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Фильтрация возвращаемого списка</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Когда Вы &quot;вызываете&quot; WMI класс, вы можете указать простое равенство для параметра, чтобы сузить список. Эта фильтрация обрабатывается на уровне WMI; вы можете делать любую последующую фильтрацию, которая вам нужна, в коде Python, как только вы получите значения. Обратите внимание, что даже если список содержит только один элемент, это всё еще список. Чтобы найти все жёсткие диски, можно написать: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for disk in c.Win32_LogicalDisk(DriveType=3):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print disk.Name</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Выбор только указанных полей</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">По умолчанию в запросе будут возвращены все поля в классе. Из соображений производительности или просто управляемости, вы можете получать только некоторые поля. Это можно сделать, устанавливая первый позиционный параметр как список имён полей. Обратите внимание, что ключевое поле (обычно идентификатор, уникальное имя или даже их комбинация) будет возвращаться всегда: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for disk in c.Win32_LogicalDisk([&quot;Caption&quot;, &quot;Description&quot;], DriveType=3):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print disk.Caption, disk.Description</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Исполнение произвольных запросов WQL</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы хотите выполнить произвольные запросы WMI, используя псевдо-SQL язык WQL, вы можете использовать метод query пространства имён. Например, перечисление всех нежёстких дисков: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">wql = &quot;SELECT Caption, Description FROM Win32_LogicalDisk WHERE DriveType &lt;&gt; 3&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for disk in c.query(wql):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print disk.Caption, disk.Description</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Внутренние события</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Внутренние события происходят, когда вы подключаетесь к общему механизму событий, предлагаемому системой WMI, чтобы опросить другие классы от вашего имени. Вы можете проследить создание, модификацию или удаление любого WMI класса. Вы должны определить тип события (создание, удаление или модификация) и задать частоту опроса в целых секундах. После этих параметров вы можете привести именованные параметры, чтобы обычным способом уменьшить количество возвращённых событий. Обратите внимание, что, так как это опрашивает неявно, вы не можете использовать это для, например, контроля полной структуры каталога. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Чтобы наблюдать за системным логом ошибок, напишите: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># -*- coding: cp1251 -*-</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(privileges=[&quot;Security&quot;])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">watcher = c.Win32_NTLogEvent.watch_for(&quot;creation&quot;, 2, Type=&quot;error&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">while 1:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    error = watcher()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;Ошибка в логе %s: %s&quot; % (error.Logfile, error.Message)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    # посылка письма администратору и т.п.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Один нюанс: опрос происходит с той частотой, с какой вы определили. Таким образом, возможно пропустить какие-то события. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">v1.3.1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">: метод watch_for возвращает фактически специальный объект события wmi, который включает объект, который вызвал код и, для внутренних событий, тип события, отметку времени и предыдущее значение при модификации. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Внешние события</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Обратите внимание, что несмотря на то, что &quot;Win32_NTLogEvent&quot; заканчивается на &quot;Event&quot;, на самом деле это - не внешнее событие. Вы можете определить, какие классы являются внешними событиями, исследуя их происхождение: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print c.Win32_PowerManagementEvent.derivation()</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Или вы можете идти от вершины вниз и разыскивать подклассы __ExtrinsicEvent: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for i in c.subclasses_of(&quot;__ExtrinsicEvent&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Внешние события используются аналогичным способом, как внутренние. Различие состоит в том, что любой тип события и задержка игнорируются, т.к. WMI не опрашивает от вашего имени, а ожидает на основной подсистеме. Метод watch_for возвращает все ещё объект события wmi (v1.3.1), но уже без event_info, который не поддерживается WMI. Предположим, вы хотите делать что-то всякий раз, когда ваш компьютер выходит из режима standby, например, уведомить группу IM о вашем присутствии: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># -*- coding: cp1251 -*-</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import datetime</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">watcher = c.Win32_PowerManagementEvent.watch_for(EventType=7)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    event = watcher()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;resumed&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    # Число 100-наносекундных интервалов с 1-ого января 1601!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    # TIME_CREATED, возможно, не поддерживается в Win2K</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    # прим. перев.: время будет выведено без учёта поясов и летнего времени (т.е. &quot;чистое&quot; GMT).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    if hasattr(event, &quot;TIME_CREATED&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        ns100 = int(event.TIME_CREATED)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        offset = datetime.timedelta(microseconds=ns100 / 10)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        base = datetime.datetime(1601, 1, 1)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;Resumed at&quot;, base  + offset</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Для внутреннего события модификации вы можете произвести сравнение значений &quot;до&quot; и &quot;после&quot; объекта &quot;триггера&quot;: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">watcher = c.Win32_Process.watch_for(&quot;modification&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">event = watcher()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print &quot;Modification occurred at&quot;, event.timestamp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print event.path()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">prev = event.previous</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">curr = event</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for p in prev.properties:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    pprev = getattr(prev, p)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    pcurr = getattr(curr, p)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    if pprev != pcurr:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print p</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;  Previous:&quot;, pprev</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;   Current:&quot;, pcurr</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Слежение с тайм-аутами</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Возможно и большее! Хотя вы можете использовать слежение в потоках, в некоторых случаях проще осуществлять опрос через некоторые интервалы времени. Если, например, вы хотите контролировать события печати на двух компьютерах, не занимаясь потоками и очередями, вы можете написать: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">def wmi_connection(server, username, password):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;attempting connection with&quot;, server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    if username:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        return wmi.WMI(server, user=username, password=password)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        return wmi.WMI(server)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">servers = [</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">   (&quot;.&quot;, &quot;&quot;, &quot;&quot;),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">   (&quot;goyle&quot;, &quot;wmiuser&quot;, &quot;secret&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">watchers = {}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for server, username, password in servers:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    connection = wmi_connection(server, username, password)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    watchers[server] = connection.Win32_PrintJob.watch_for(&quot;creation&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">while True:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    for server, watcher in watchers.items():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        try:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            event = watcher(timeout_ms=10)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        except wmi.x_wmi_timed_out:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            pass</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            print &quot;print job added on&quot;, server</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            print event.Name</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            print event.TotalPages, event.PagesPrinted, event.Owner</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Исследование доступных методов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы исследуете ключи словаря methods, в котором каждый обёрнутый класс WMI кэширует свои обёрнутые методы, вы увидите, какие методы поддерживаются: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c.Win32_ComputerSystem.methods.keys()</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Вывод сигнатур методов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Каждый обёрнутый метод имеет сигнатуру. Если функция (типа Shutdown) требует дополнительных привилегий, это также будет обозначено: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">os = c.Win32_OperatingSystem</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for method_name in os.methods:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    method = getattr(os, method_name)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print method</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Обратите внимание, что если параметр, как ожидается, будет списком, это будет отображено со скобками &quot;[]&quot;. Обратите внимание также, что возвращаемые значения - всегда словарь, хотя бы и имеющий длину, равную единице. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Поиск эквивалентов методов Win32 API</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Немного удивительно, но WMI может сообщить вам, какой вызов Win32 API происходит, когда вы вызываете метод WMI (но, к сожалению, не свойство). Это поддерживается как атрибут provenance обёртки функции: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print c.Win32_Process.Create.provenance</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<hr />
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Создание объектов WMI</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">WMI предоставляет метод SpawnInstance_, который обёрнут как метод new класса WMI в Python. Но вы будете использовать этот метод намного менее часто, чем вы, возможно, думаете. Например, если вы хотите создать новый дисковый ресурс, вместо того чтобы использовать Win32_Share.new, вы фактически вызовете метод Create класса Win32_Share. Фактически, большинство классов, которые позволяют создание объекта через WMI, предлагают метод Create (Win32_Process, Win32_Share и т.д.). </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">result, = c.Win32_Share.Create(Path=&quot;c:\\temp&quot;, Name=&quot;temp&quot;, Type=0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">if result == 0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;Share created successfully&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">else:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    raise RuntimeError, &quot;Problem creating share: %d&quot; % result</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Иногда вы будете должны породить новый объект - например, если вы должны подать объект WMI, созданный на лету, другому объекту. Типичный пример - это передача описателя безопасности новому объекту или обработка информации запуска для нового процесса. Пример из MSDN </span><a href="http://msdn2.microsoft.com/en-us/library/aa394375.aspx"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://msdn2.microsoft.com/en-us/library/aa394375.aspx</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> может быть переведён на Python следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># -*- coding: cp1251 -*-</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import win32con</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">process_startup = c.Win32_ProcessStartup.new()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">process_startup.ShowWindow = win32con.SW_NORMAL</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># можно было также:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># process_startup = c.Win32_ProcessStartup.new(ShowWindow=win32con.SW_NORMAL)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">process_id, result = c.Win32_Process.Create(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    CommandLine=&quot;notepad.exe&quot;,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    ProcessStartupInformation=process_startup</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">if result == 0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print unicode(&quot;Процесс запущен успешно: %d&quot; % process_id, &quot;cp1251&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    raise RuntimeError, \</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        unicode(&quot;Неудачный запуск процесса: %d&quot; % result, &quot;cp1251&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Информация о классе/объекте</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Каждый класс или объект возвращают читабельную версию своей структуры, если представлены как строка: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print c.Win32_OperatingSystem</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for os in c.Win32_OperatingSystem():</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print os</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Иерархия объекта</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Объекты WMI существуют в пределах иерархии классов. Каждый объект знает своих собственных предков: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">print c.Win32_Process.derivation()</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Вы можете также просматривать дерево вниз, находя все подклассы названного класса, произвольно фильтруя информацию с помощью регулярных выражений. Поиск всех классов внешних событий (не обозначенных начальным символом подчеркивания): </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for extrinsic_event in c.subclasses_of(&quot;__ExtrinsicEvent&quot;, &quot;[^_].*&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print extrinsic_event</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print &quot;  &quot;, &quot; &lt; &quot;.join(getattr(c, extrinsic_event).derivation())</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Сравнение двух объектов WMI на равенство</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Оператор __eq__ перегружен в обёрнутых классах WMI и вызывает метод CompareTo, сравнивая два объекта WMI на равенство. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Связанные классы</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Associators - это классы, которые связывают вместе другие классы. Если, например, вы хотите знать, какие группы есть в вашей системе, и какие пользователи находятся в каждой группе: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for group in c.Win32_Group():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print group.Caption</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    for user in group.associators(wmi_result_class=&quot;Win32_UserAccount&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;  &quot;, user.Caption</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Это может быть записано также в терминах классов associator: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for group in c.Win32_Group():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print group.Caption</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    for user in group.associators(&quot;Win32_GroupUser&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print &quot;  &quot;, user.Caption</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<hr />
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Повышение производительности</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Благодаря полезному сотрудничеству с Паулем Тиманном (Paul Tiemann), модуль значительно повысил свою производительность при помощи комбинации кэширования и лёгких запросов, где это необходимо. Здесь описано не всё, а только наиболее явные усовершенствования, удаляющие интроспекцию во время выполнения и кэширующие так, чтобы все обёртки были сгенерированы только по требованию и могли предкэшироваться. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Исключение интроспекции</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Ядро модуля и большая его используемая часть находятся в интерпретаторе. По этой причине, когда вы обращаетесь к пространству имён WMI, разыскиваются все классы, доступные в этом пространстве имён. Это может занимать продолжительное время на большом пространстве имён, да и не нужно даже на меньших пространствах имён, если вы знаете точно, к чему вы будете обращаться после. Поэтому в &quot;промышленном&quot; коде вы можете это отключить: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(find_classes=False)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы определили, какие классы являются доступными, вы всё ещё можете использовать subclasses_of (как описано выше), чтобы искать, например, классы производительности, доступные на данной машине во время выполнения: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(find_classes=False)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">perf_classes = c.subclasses_of(&quot;Win32_PerfRawData&quot;)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Предкэширование обёрток классов и методов</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Чтобы избегать начального запуска поиска, когда к классу делается запрос или вызывается его метод, можно просто заранее поместить класс в кэш, обращаясь к нему. Развивая код, приведённый выше: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"># -*- coding: cp1251 -*-</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(find_classes=False)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for perf_class in c.subclasses_of(&quot;Win32_PerfRawData&quot;):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    # не делать ничего, только получить это в кэш</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    getattr(c, perf_class)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Указание полей в запросе</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">По умолчанию запрос WMI возвратит все поля класса для каждого объекта. Определяя поля, вы задаёте их как первый параметр запроса, во избежание любых ресурсоёмких поисков: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">c = wmi.WMI(find_classes=False)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">for i in c.Win32_Process([&quot;Caption&quot;, &quot;ProcessID&quot;]):</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Безопасность</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Самый простой путь, чтобы обратиться к функциональным возможностям WMI, состоит в том, чтобы исполнять скрипт с правами администратора домена. Другие методы конечно возможны, но таят в себе различные подводные камни. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Безопасность NT</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Пользователь должен иметь некоторый доступ к машине, функциональные возможности WMI которой вызываются. Это может заключаться во включении его в локальную группу администраторов или в определении доступа конкретному пользователю. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Безопасность DCOM</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">WMI - технология, основанная на DCOM. Если есть проблема подтверждения подлинности на уровне DCOM, тогда, в теории, вы должны иметь ту же самую проблему, делая DispatchEx на Word.Application. Программа, которую вам стоит посмотреть - dcomcnfg.exe. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Безопасность WMI</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Пространства имён WMI - это системные объекты со своими собственными дескрипторами безопасности. Если Вы обратитесь к MMC-оснастке WMI через mmc.exe, вы найдёте там вкладку безопасности. Учетная запись, использующая функциональные возможности WMI на этой машине, должна иметь достаточный доступ. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">WMI и потоки</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">WMI - это механизм, основанный на COM/DCOM, поэтому механизм потоков COM также используется и в WMI. Это не зависит от того, действительно ли ваша программа явно вызывает поток в Python: например, если вы выполняете код в службе, вы вероятно используете потоки, нравится вам это или нет. Пример с потоками на Python: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import pythoncom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import wmi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import threading</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">import time</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">class Info(threading.Thread):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    def __init__(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        threading.Thread.__init__(self)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    def run(self):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print 'In Another Thread...'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        pythoncom.CoInitialize()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        try:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            for i in range(5):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">                for process in c.Win32_Process():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">                    print process.ProcessId, process.Name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">                time.sleep(2)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        finally:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">            pythoncom.CoUninitialize()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">if __name__ == '__main__':</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    print 'In Main Thread'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    c = wmi.WMI()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    for process in c.Win32_Process():</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">        print process.ProcessId, process.Name</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt; font-weight:600; color:#000080;">    Info().start()</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:9pt;"><br /></p></body></html>