<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="distributed-queries"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:large; font-weight:600;">Р</span><span style=" font-family:'MS Shell Dlg 2'; font-size:large; font-weight:600;">аспределенные запросы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">Импортируйте данные напрямую из файлов Excel с помощью функции Transact-SQL </span><span style=" font-family:'Courier New,courier';">OPENROWSET</span><span style=" font-family:'MS Shell Dlg 2';"> или </span><span style=" font-family:'Courier New,courier';">OPENDATASOURCE</span><span style=" font-family:'MS Shell Dlg 2';">. Такая операция называется </span><span style=" font-family:'MS Shell Dlg 2'; font-style:italic;">распределенный запрос</span><span style=" font-family:'MS Shell Dlg 2';">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">Перед выполнением распределенного запроса необходимо включить параметр </span><span style=" font-family:'Courier New,courier';">ad hoc distributed queries</span><span style=" font-family:'MS Shell Dlg 2';"> в конфигурации сервера, как показано в примере ниже. Дополнительные сведения см. в статье </span><a href="https://docs.microsoft.com/ru-ru/sql/database-engine/configure-windows/ad-hoc-distributed-queries-server-configuration-option?view=sql-server-2017"><span style=" font-family:'MS Shell Dlg 2'; text-decoration: underline; color:#0000ff;">ad hoc distributed queries Server Configuration Option</span></a><span style=" font-family:'MS Shell Dlg 2';"> (Параметр конфигурации сервера &quot;ad hoc distributed queries&quot;).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">sp_configure 'show advanced options', 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">RECONFIGURE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">sp_configure 'Ad Hoc Distributed Queries', 1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">RECONFIGURE;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">В приведенном ниже примере кода данные импортируются из листа Excel </span><span style=" font-family:'Courier New,courier';">Data</span><span style=" font-family:'MS Shell Dlg 2';"> в новую таблицу базы данных с помощью </span><span style=" font-family:'Courier New,courier';">OPENROWSET</span><span style=" font-family:'MS Shell Dlg 2';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">USE ImportFromExcel;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">SELECT * INTO Data_dq</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    'Excel 12.0; Database=D:\Desktop\Data.xlsx', [Data$]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">Ниже приведен тот же пример с </span><span style=" font-family:'Courier New,courier';">OPENDATASOURCE</span><span style=" font-family:'MS Shell Dlg 2';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">USE ImportFromExcel;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">SELECT * INTO Data_dq</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">FROM OPENDATASOURCE('Microsoft.ACE.OLEDB.12.0',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    'Data Source=D:\Desktop\Data.xlsx;Extended Properties=Excel 12.0')...[Data$];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">GO</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">Чтобы </span><span style=" font-family:'MS Shell Dlg 2'; font-style:italic;">добавить</span><span style=" font-family:'MS Shell Dlg 2';"> импортированные данные в </span><span style=" font-family:'MS Shell Dlg 2'; font-style:italic;">существующую</span><span style=" font-family:'MS Shell Dlg 2';"> таблицу, а не создавать новую, используйте синтаксис </span><span style=" font-family:'Courier New,courier';">INSERT INTO ... SELECT ... FROM ...</span><span style=" font-family:'MS Shell Dlg 2';"> вместо синтаксиса </span><span style=" font-family:'Courier New,courier';">SELECT ... INTO ... FROM ...</span><span style=" font-family:'MS Shell Dlg 2';"> из предыдущих примеров.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2';">Для обращения к данным Excel без импорта используйте стандартный синтаксис </span><span style=" font-family:'Courier New,courier';">SELECT ... FROM ...</span><span style=" font-family:'MS Shell Dlg 2';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2';"><br /></p></body></html>