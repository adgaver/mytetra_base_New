<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td></td>
<td>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/timer/htmlfile"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">Запуск макроса VBA по таймеру</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/taxonomy/term/14"><span style=" text-decoration: underline; color:#0000ff;">Макросы VBA Excel</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/code/another"><span style=" text-decoration: underline; color:#0000ff;">Разное</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:9pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelvba.ru/category/calendar"><span style=" text-decoration: underline; color:#0000ff;">Календарь (дата, время)</span></a> </li></ul></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В Excel есть инструментарий для запуска макроса по расписанию, - Application.Ontime<br />При помощи этого метода можно запускать макрос с заданным интервалом (например, раз в секунду)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Но есть и другой вариант, - использование объекта htmlfile:<br />(код надо поместить в модуль ЭтаКнига - ThisWorkbook)<br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Private</span><span style=" font-family:'monospace'; font-size:9pt;"> m_TimerId </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Variant</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Private</span><span style=" font-family:'monospace'; font-size:9pt;"> m_doc </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">As</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Object</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Const</span><span style=" font-family:'monospace'; font-size:9pt;"> ATTRNAME = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;VBATimerHandler&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Private</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> StartTimer()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Const</span><span style=" font-family:'monospace'; font-size:9pt;"> Script = </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;document.documentElement.getAttribute('&quot;</span><span style=" font-family:'monospace'; font-size:9pt;"> &amp; ATTRNAME &amp; </span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;').TimerProc()&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    EndTimer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> m_doc = CreateObject(</span><span style=" font-family:'monospace'; font-size:9pt; color:#800000;">&quot;htmlfile&quot;</span><span style=" font-family:'monospace'; font-size:9pt;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    m_doc.DocumentElement.setAttribute ATTRNAME, Me</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    m_TimerId = m_doc.parentWindow.setInterval(Script, 50)        </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' интервал 50 миллисекунд</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Private</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> EndTimer()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> m_doc </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Is</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Exit</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Not</span><span style=" font-family:'monospace'; font-size:9pt;"> IsEmpty(m_TimerId) </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        m_doc.parentWindow.clearInterval m_TimerId</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">        m_TimerId = Empty</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    m_doc.DocumentElement.removeAttribute ATTRNAME</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Set</span><span style=" font-family:'monospace'; font-size:9pt;"> m_doc = </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Nothing</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Public</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span><span style=" font-family:'monospace'; font-size:9pt;"> TimerProc()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    </span><span style=" font-family:'monospace'; font-size:9pt; color:#008000;">' этот макрос будет запускаться 20 раз в секунду</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt;">    Debug.</span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Print</span><span style=" font-family:'monospace'; font-size:9pt;"> Now()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">End</span><span style=" font-family:'monospace'; font-size:9pt;"> </span><span style=" font-family:'monospace'; font-size:9pt; color:#000080;">Sub</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Источник: </span><a href="http://www.ka-net.org/office/of12.html"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">http://www.ka-net.org/office/of12.html</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p></td></tr></table></body></html>