<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="post-title"></a><span style=" font-size:8.25pt; font-weight:600;">А</span><span style=" font-size:8.25pt; font-weight:600;">бсолютные и относительные ссылки в Power Query — подход в стиле Excel</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Эта статья — перевод моего </span><a href="http://excel-inside.pro/blog/2015/11/05/absolute-and-relative-references-in-power-query/"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">первого поста в этом блоге</span></a><span style=" font-size:8.25pt;">, который был опубликован 5 ноября 2015 года на английском языке. К моему удивлению, этот пост — самый популярный, за это время он набрал почти 21000 просмотров. С небольшими стилистическими правками публикую его на русском языке. В переводе помогал мой сын Дмитрий, за что ему отдельное спасибо.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Power Query — это мощный инструмент, способный на большее, чем просто брать данные из источника и переносить их в таблицу или Power Pivot. Данные можно очищать и преобразовывать множеством способов, но есть некоторые действия, привычные для Excel, которые не так удобно делать в Power Query.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Например, что, если мне нужна относительная ссылка на конкретную ячейку в таблице Power Query — значение из определённой строки в определённом столбце? Или ссылка на значение в определённом столбце на четыре строки выше? В Excel очевидно, как это сделать: нужно просто указать на нужное значение мышкой, убедиться, что из ссылки к строке убран знак «$» (знак абсолютной ссылки), и всё. Но в Power Query я не могу так просто это сделать.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Но всё же решение, хотя и непрямое, существует.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Прежде всего давайте выясним, как можно получить доступ к конкретному значению из таблицы Power Query.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Простейший способ понять адресацию в Power Query, по-моему, анализировать код шагов.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Абсолютные ссылки на строки</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Допустим, у нас есть простая таблица из двух столбцов: даты (Date) и количества (Amount). В ней пять строк, и в первом столбце стоят, как ни странно, даты, во втором — какие-то значения:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="caption-attachment-8"></a><span style=" font-size:8.25pt;">И</span><span style=" font-size:8.25pt;">сходные данные</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Мы хотим получить значение из ячейки B4, а именно </span><span style=" font-size:8.25pt; font-weight:600;">120</span><span style=" font-size:8.25pt;">.</span><a name="more-327"></a><span style=" font-size:8.25pt;"><br /></span><span style=" font-size:8.25pt;">В Excel это просто: мы просто пишем ссылку вроде =B4, или =R4C2 в стиле R1C1.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Можно ли использовать этот стиль ссылок (R1C1) в Power Query? Да.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Загрузите эту таблицу в Power Query, щёлкните правой мышкой по нужному значению и выберите “drill to details”. Отлично, мы получили 120.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Теперь взглянем на код. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556276674875890"></a><span style=" font-size:8.25pt;">l</span><span style=" font-size:8.25pt;">et Source = Excel.CurrentWorkbook(){[Name=&quot;Tab_1&quot;]}[Content], Amount = Source{2}[Amount] in Amount </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">5 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556276674875890-1"></a><span style=" font-size:8.25pt;">l</span><span style=" font-size:8.25pt;">et</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-615f28f556276674875890-2"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Source = Excel.CurrentWorkbook(){[Name=&quot;Tab_1&quot;]}[Content],</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-615f28f556276674875890-3"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Amount = Source{2}[Amount]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-615f28f556276674875890-4"></a><span style=" font-size:8.25pt;">i</span><span style=" font-size:8.25pt;">n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-615f28f556276674875890-5"></a><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt;">   Amount</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В третьей строке кода мы видим искомую ссылку. Заметьте, что мы ссылаемся на предыдущий шаг (как обычно), затем пишем {2} и затем название столбца [Amount].</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Важно</span><span style=" font-size:8.25pt;">: строки и списки в Power Query нумеруются с нуля: первая позиция в списке всегда имеет номер 0, то же самое касается номеров строк в таблице. Поэтому, запрашивая в Power Query значение из </span><span style=" font-size:8.25pt; text-decoration: underline;">третьей</span><span style=" font-size:8.25pt;"> строки, мы должны использовать </span><span style=" font-size:8.25pt; text-decoration: underline;">число 2</span><span style=" font-size:8.25pt;"> для обозначения строки.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Эта формула расшифровывается так: дай мне значение из поля [</span><span style=" font-size:8.25pt; font-weight:600;">Amount</span><span style=" font-size:8.25pt;">] в строке с </span><span style=" font-size:8.25pt; font-weight:600;">индексом 2</span><span style=" font-size:8.25pt;"> таблицы </span><span style=" font-size:8.25pt; font-weight:600;">Source</span><span style=" font-size:8.25pt;">. Иными словами, формула ищет определённый номер записи в таблице и затем возвращает значение определённого поля из этой записи.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Формула, полученная нами из редактора, фактически использует два последовательных подхода: выражение: </span><span style=" font-family:'Courier New'; font-size:8.25pt;"> </span><a name="crayon-615f28f55627e476705328"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">N</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ame{Argument} </span><span style=" font-size:8.25pt;"> и выражение  </span><a name="crayon-615f28f556284530260711"></a><span style=" font-size:8.25pt;">R</span><span style=" font-size:8.25pt;">ecord[Field].</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Синтаксис </span><span style=" font-family:'Courier New'; font-size:8.25pt;"> </span><a name="crayon-615f28f556285032619608"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">N</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ame{Argument}</span><span style=" font-size:8.25pt;"> имеет несколько реализаций:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если <a name="crayon-615f28f556287118968624"></a><span style=" font-family:'Courier New'; font-size:16px;">N</span><span style=" font-family:'Courier New'; font-size:16px;">ame</span> — это <span style=" font-weight:600;">список (list)</span>, а <span style=" font-family:'Courier New'; font-style:italic;"> </span><a name="crayon-615f28f556288989025778"></a><span style=" font-family:'Courier New'; font-size:16px; font-style:italic;">A</span><span style=" font-family:'Courier New'; font-size:16px; font-style:italic;">rgument</span>— <span style=" font-weight:600;">число (number)</span>, выражение возвращает элемент с соответствующим номером из списка <span style=" font-style:italic;">Name</span>;</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если <a name="crayon-615f28f556289585037374"></a><span style=" font-family:'Courier New'; font-size:16px;">N</span><span style=" font-family:'Courier New'; font-size:16px;">ame</span> — это <span style=" font-weight:600;">таблица (table)</span>, а <a name="crayon-615f28f55628a572546279"></a><span style=" font-family:'Courier New'; font-size:16px;">A</span><span style=" font-family:'Courier New'; font-size:16px;">rgument</span> — <span style=" font-weight:600;">число (number)</span>, выражение возвращает строку с соответствующим номером из таблицы <span style=" font-style:italic;">Name</span>;</li>
<li style=" font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">если <a name="crayon-615f28f55628c583605974"></a><span style=" font-family:'Courier New'; font-size:16px;">N</span><span style=" font-family:'Courier New'; font-size:16px;">ame</span> — это <span style=" font-weight:600;">таблица (table)</span>, а <a name="crayon-615f28f55628d130919194"></a><span style=" font-family:'Courier New'; font-size:16px;">A</span><span style=" font-family:'Courier New'; font-size:16px;">rgument</span> — <span style=" font-weight:600;">запись (record)</span>, выражение возвращает <span style=" text-decoration: underline;">уникальную</span> строку из таблицы <a name="crayon-615f28f55628e885409476"></a><span style=" font-family:'Courier New'; font-size:16px;">N</span><span style=" font-family:'Courier New'; font-size:16px;">ame</span>, в которой значения полей соответствуют значениям аналогичных полей записи <a name="crayon-615f28f556290185426744"></a><span style=" font-family:'Courier New'; font-size:16px;">A</span><span style=" font-family:'Courier New'; font-size:16px;">rgument</span>.</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Последний вариант даёт представить множество возможностей использования, но сейчас мы вернемся прямо к нашему вопросу: абсолютные и относительные ссылки на одиночное значение.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Выражение </span><a name="crayon-615f28f556291648297695"></a><span style=" font-size:8.25pt;">R</span><span style=" font-size:8.25pt;">ecord[Field] имеет почти такой же синтаксис: оно ищет поле в записи по имени поля. Если в записи нет указанного поля, код выдаёт ошибку.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Взгляните снова на нашу формулу: сперва мы получаем строку (запись) из таблицы Source с номером 2: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556292580410082"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ource{2} </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556292580410082-1"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ource{2}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Затем из этой записи мы получаем поле [Amount] (строка таблицы — это запись с именами столбцов в качестве имён полей): </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556294376215235"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ource{2}[Amount] </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556294376215235-1"></a><span style=" font-size:8.25pt;">S</span><span style=" font-size:8.25pt;">ource{2}[Amount]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Выглядит просто, да?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Но погодите, если мы запросим в Power Query одиночный столбец из таблицы, мы получим как раз нужный список: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556295933863286"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yList = Source[Amount] </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556295933863286-1"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yList = Source[Amount]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Так что, если нам нужно конкретное значение из этого списка (см. первый пункт в описании синтаксиса </span><a name="crayon-615f28f556296930621729"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">N</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ame{Argument}</span><span style=" font-size:8.25pt;">выше), мы просто добавляем в фигурных скобках номер значения после имени списка: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556297439373007"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yValue = MyList{2} </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556297439373007-1"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yValue = MyList{2}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Эти два шага можно сократить в один: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556298915307895"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yValue = Source[Amount]{2} </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f556298915307895-1"></a><span style=" font-size:8.25pt;">M</span><span style=" font-size:8.25pt;">yValue = Source[Amount]{2}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">и получить искомое значение, 120.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Таким образом, у нас фактически есть два возможных способа обратиться к одиночному значению в таблице Power Query.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Давайте сравним два способа адресации:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обратиться к определённой записи в таблице и получить определённое поле из этой записи: <a name="crayon-615f28f556299430802093"></a><span style=" font-size:16px;">M</span><span style=" font-size:16px;">yValue = Source{2}[Amount]</span></li></ul>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Получить список из столбца таблицы и получить значение по определённому номеру в этом списке: <a name="crayon-615f28f55629b428761307"></a><span style=" font-size:16px;">M</span><span style=" font-size:16px;">yValue = Source[Amount]{2}</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Они выглядят очень похоже, и может показаться, что нет разницы, в каком порядке ставить название столбца и порядковый номер. На самом деле это два разных подхода, и это нужно запомнить, чтобы использовать в будущем.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Но в любом случае оба подхода дают нам ключ к любым ссылкам на строки в таблицах Power Query.</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Относительные ссылки на строки</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В таблице-образце находятся данные, похожие на остатки на счёте. Предположим, нам нужно добавить столбец, вычисляющий и показывающий изменение значения на счёте. Для этого нужно получить значение из предыдущей строки и сравнить его со значением в текущей строке.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Но в предыдущих примерах мы видели, что ссылка на позицию и столбец зашиты внутрь формулы. Значит, нам нужно найти способ преобразовать номера строк в относительные ссылки.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">И здесь нам (вновь) приходит на помощь Excel. Что бы мы сделали в Excel, чтобы произвести такое вычисление? В простом случае мы просто помещаем в ячейку C3 формулу  </span><a name="crayon-615f28f55629c126579229"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">B3-B2 и растягиваем её на столбец. Но, если мы запишем эту формулу в стиле R1C1, то получим следующее:  </span><a name="crayon-615f28f55629d320220957"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">RC[-1]-R[-1]C[-1]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Это значит: возьми значение из этой строки и столбца на один левее и вычти из него значение из строки на одну выше и столбца на один левее. В Power Query в большинстве случаев мы будем работать с данными из известных столбцов, так что давайте представим, что мы можем опустить часть, относящуюся к столбцу, и ссылаться только на строку, в стиле R1: </span><a name="crayon-615f28f55629f156578320"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">R–R[-1]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Итак, вот оно. Нам нужно получить номер текущей строки и вычислить номер предыдущей, чтобы использовать формулу такого рода: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a0121052606"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Source{current_row_number}[Amount] - Source{current_row_number-1}[Amount] </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a0121052606-1"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Source{current_row_number}[Amount] - Source{current_row_number-1}[Amount]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">или </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a1960744423"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Source[Amount]{current_row_number} - Source[Amount]{current_row_number-1} </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a1960744423-1"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Source[Amount]{current_row_number} - Source[Amount]{current_row_number-1}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Итак, можно ли получить номер строки в Power Query? Да, с помощью специального столбца индексов </span><span style=" font-size:8.25pt; font-weight:600;">Index</span><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Столбец индексов генерирует список целочисленных значений, начинающихся с N, с шагом S для каждой строки таблицы. Интерфейс Power Query позволяет выбрать один из двух наиболее популярных вариантов столбцов индексов: “From 0” (с нуля, по умолчанию) или “From 1” (с единицы, оба с шагом 1) — или создать собственный список со своими значениями параметров Start (начальное значение) и Step (шаг).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Давайте добавим столбец индексов, начинающихся с нуля, после шага </span><span style=" font-size:8.25pt; font-style:italic;">Source</span><span style=" font-size:8.25pt;"> в Power Query: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a2339491245"></a><span style=" font-size:8.25pt;">#</span><span style=" font-size:8.25pt;">&quot;Added index&quot; = Table.AddIndexColumn(Source, &quot;Index&quot;, 0, 1) </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a2339491245-1"></a><span style=" font-size:8.25pt;">#</span><span style=" font-size:8.25pt;">&quot;Added index&quot; = Table.AddIndexColumn(Source, &quot;Index&quot;, 0, 1)</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Теперь у нас есть всё, что нужно: мы знаем название столбца и можем получить из столбца индексов номер строки. Давайте переименуем предыдущий шаг в </span><a name="crayon-615f28f5562a4448622011"></a><span style=" font-size:8.25pt;">A</span><span style=" font-size:8.25pt;">ddInd для ускорения написания и новым шагом добавим собственный вычисляемый столбец, вводя следующую формулу в диалоговое окно: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a5886819246"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1} </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a5886819246-1"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1}</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Таким образом, полная формула этого шага выглядит так: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a6658163473"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Table.AddColumn(AddInd, &quot;Custom&quot;, each AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1}) </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562a6658163473-1"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;"> Table.AddColumn(AddInd, &quot;Custom&quot;, each AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1})</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Мы только что сделали следующее: в каждой строке таблицы мы ссылаемся на значение из столбца </span><a name="crayon-615f28f5562a7253408415"></a><span style=" font-size:8.25pt;">I</span><span style=" font-size:8.25pt;">ndex как аргумент для выражения </span><a name="crayon-615f28f5562a8374979726"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">N</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ame{Argument}</span><span style=" font-size:8.25pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">В этом примере я использовал тип ссылки по положению в списке (см. п.1), а не по записи в таблице. Посмотрите на результат в окне предпросмотра Power Query:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="caption-attachment-9"></a><span style=" font-size:8.25pt;">З</span><span style=" font-size:8.25pt;">десь можно увидеть, как работают относительные ссылки на строки в Power Query</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">У нас есть искомый список изменений значений из столбца </span><a name="crayon-615f28f5562aa730811589"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">A</span><span style=" font-family:'Courier New'; font-size:8.25pt;">mount</span><span style=" font-size:8.25pt;">, но с </span><span style=" font-size:8.25pt; font-weight:600; font-style:italic;">ошибкой (error)</span><span style=" font-size:8.25pt;"> в первой строке. Очевидно, ведь строки с номером (0-1)=-1 нет. Если бы мы использовали ссылку </span><span style=" font-size:8.25pt; text-decoration: underline;">больше</span><span style=" font-size:8.25pt;"> последнего номера строки, то нужно было бы использовать “?” (вопросительный знак) после ссылки на номер строки. Это называется “факультативный выбор объекта”.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Давайте посмотрим, как это работает. Вернёмся на шаг назад и добавим ещё один столбец со следующей формулой: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562ab490591518"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">AddInd[Amount]{[Index]+1}? </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562ab490591518-1"></a><span style=" font-size:8.25pt;">=</span><span style=" font-size:8.25pt;">AddInd[Amount]{[Index]+1}?</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Мы получим вот это:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="caption-attachment-10"></a><span style=" font-size:8.25pt;">«</span><span style=" font-size:8.25pt;">Факультативный выбор объекта» возвращает null, если выйти за границу количества строк</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">т.е. ссылка на несуществующий номер в списке была заменена значением null. Но, как я уже говорил, это работает только с номерами </span><span style=" font-size:8.25pt; text-decoration: underline;">не меньше</span><span style=" font-size:8.25pt;"> количества объектов в списке (или записей в таблице). Для отрицательных номеров формула выдаёт ошибку.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Теперь давайте уберём этот шаг и вернёмся к добавленному ранее столбцу с ошибкой в первой строке.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Что можно сделать с этой ошибкой? Мы можем добавить ещё один шаг с помощью UI: замену ошибок. Просто выбираем наш столбец Custom, затем на вкладке Transform выполняем Replace errors…, и вводим в диалоговое окно значение 0. Либо просто добавляем эту формулу в редактор: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562ac865010491"></a><span style=" font-size:8.25pt;">R</span><span style=" font-size:8.25pt;">emErrs = Table.ReplaceErrorValues(AddCust1, {{&quot;Custom&quot;, 0}}) </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562ac865010491-1"></a><span style=" font-size:8.25pt;">R</span><span style=" font-size:8.25pt;">emErrs = Table.ReplaceErrorValues(AddCust1, {{&quot;Custom&quot;, 0}})</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Отлично, мы получили, что хотели:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="caption-attachment-11"></a><span style=" font-size:8.25pt;">Т</span><span style=" font-size:8.25pt;">еперь мы заменили ошибки определёнными фиксированными значениями</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если мы хотим заменить ошибки не точными значениями, а другими вычислениями или функциями, лучше использовать конструкцию </span><a name="crayon-615f28f5562ae939914756"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">t</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ry - otherwise</span><span style=" font-size:8.25pt;">, работающую как функция IFERROR (ЕСЛИОШИБКА)в Excel. Нужно просто исправить предыдущий шаг (на котором мы добавляли первый вычисляемый столбец). Щёлкните шестерёнку (“gear”) рядом с именем шага и замените формулу следующей: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562af021354875"></a><span style=" font-size:8.25pt;">t</span><span style=" font-size:8.25pt;">ry AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1} otherwise 0 </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><span style=" font-size:8.25pt;">1 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px;"><a name="crayon-615f28f5562af021354875-1"></a><span style=" font-size:8.25pt;">t</span><span style=" font-size:8.25pt;">ry AddInd[Amount]{[Index]}-AddInd[Amount]{[Index]-1} otherwise 0</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">или внесите необходимые исправления прямо в строке формул. После оператора </span><a name="crayon-615f28f5562b0206214267"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">o</span><span style=" font-family:'Courier New'; font-size:8.25pt;">therwise</span><span style=" font-size:8.25pt;"> может идти любое выражение, например, вы можете использовать собственную функцию, ввести текст или вернуть </span><a name="crayon-615f28f5562b1411247215"></a><span style=" font-family:'Courier New'; font-size:8.25pt;">n</span><span style=" font-family:'Courier New'; font-size:8.25pt;">ull</span><span style=" font-size:8.25pt;">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="caption-attachment-12"></a><span style=" font-size:8.25pt;">Т</span><span style=" font-size:8.25pt;">еперь мы заменили ошибки с помощью выражения «try-otherwise»</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Эй, да это же всё. Поздравляю, теперь мы знаем, как создавать абсолютные и относительные ссылки в таблицах Power Query.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Этот приём полезен во многих случаях, в основном при преобразовании и очистке сырых данных.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt; font-weight:600;">Но ОСТОРОЖНО:</span><span style=" font-size:8.25pt;"> </span><span style=" font-size:8.25pt; font-style:italic;">использование относительных ссылок в таблицах с большим количеством данных может поглощать очень много ресурсов и увеличивать время обновления запроса.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Вы можете </span><a href="http://1drv.ms/1Sr07yw"><span style=" font-size:8.25pt; text-decoration: underline; color:#0000ff;">загрузить книгу-образец</span></a><span style=" font-size:8.25pt;">, чтобы посмотреть, как это работает, и опробовать все приёмы из этой записи.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">А как насчёт относительных ссылок по столбцу? Чуть сложнее и реже встречается, но мы можем сделать и это. В следующий раз.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;">Если вы хотите почитать больше о продвинутых преобразованиях и моделировании данных в Power Query, я рекомендую следующие книги:</span></p></body></html>