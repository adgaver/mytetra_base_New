<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="question-header"></a><a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba"><span style=" font-size:xx-large; font-weight:600; text-decoration: underline; color:#0000ff;">Э</span></a><span style=" font-size:xx-large; font-weight:600; text-decoration: underline; color:#0000ff;">кспорт запросов Power из одной книги в другую с помощью VBA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://stackoverflow.com/questions/ask"><span style=" text-decoration: underline; color:#0000ff;">Задавать вопрос</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Спросил 7 лет, 6 месяцев назад</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Изменено <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba?lastactivity"><span style=" text-decoration: underline; color:#0000ff;">7 лет, 6 месяцев назад</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Я хочу перенести запросы мощности из одной книги в другую с помощью VBA. Я знаю, как сделать это вручную, но это очень громоздко.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Доступ к запросу питания можно получить через объект Workbook.Connections. В настоящее время я пытаюсь перенести запросы с помощью функции VBA или Sub.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ручной процесс выглядит следующим образом.</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style="" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">для каждого запроса в книге 1</li>
<li style="" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">откройте книгу 1 и перейдите в расширенный редактор — скопируйте в текстовый редактор</li>
<li style="" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">откройте книгу 2, создайте запрос и вставьте текст в расширенный редактор</li>
<li style="" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">убедитесь, что исходные таблицы одинаковы, и запустите запрос для проверки</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style="" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comments-41127467"></a>1</li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">О том, как задать вопрос, см. здесь: <a href="http://stackoverflow.com/help/mcve"><span style=" text-decoration: underline; color:#0000ff;">stackoverflow.com/help/mcve</span></a> . Пожалуйста, начните программировать и возвращайтесь, когда у вас возникнет конкретный вопрос, если/когда вы застрянете, поскольку это не фабрика кода. Возможно, это: <a href="https://blog.crossjoin.co.uk/2015/06/10/power-queryexcel-2016-vba-examples/"><span style=" text-decoration: underline; color:#0000ff;">blog.crossjoin.co.uk/2015/06/10/…</span></a> поможет вам начать работу. Добро пожаловать в ТАК! </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">– <a href="https://stackoverflow.com/users/4560433/opiesdad"><span style=" text-decoration: underline; color:#0000ff;">ОпиесПапа</span></a> <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#comment69460569_41127467"><span style=" text-decoration: underline; color:#0000ff;">13 дек 2016 в 18:44</span></a> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="comment-69462467"></a>Спасибо за отзыв, обновлю. Я ссылался на другие вопросы, и вопрос действителен. Я упомянул объект Workbook.Connections, который технически представляет собой код. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">– <a href="https://stackoverflow.com/users/7037499/dfresh22"><span style=" text-decoration: underline; color:#0000ff;">dfresh22</span></a> <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#comment69462467_41127467"><span style=" text-decoration: underline; color:#0000ff;">13 дек 2016 в 19:43</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="comment-69462817"></a>Объект не является кодом. Если вы не знаете, как использовать объект или спрашиваете что-то конкретное об объекте, то это будет вопрос по теме. По сути, вы сказали: «Я хочу что-то сделать. Я понятия не имею, как это сделать, но, возможно, этот объект имеет значение. Я ничего не пробовал и не создавал никакого кода. Пожалуйста, напишите полное решение для мне.&quot; Остальные вопросы, вероятно, тоже были не очень хорошими. Как только вы действительно попытались сделать это самостоятельно, вы действительно сделали это менее чем за 2 часа. Я рад, что вы проявили инициативу. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">– <a href="https://stackoverflow.com/users/4560433/opiesdad"><span style=" text-decoration: underline; color:#0000ff;">ОпиесПапа</span></a> <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#comment69462817_41127467"><span style=" text-decoration: underline; color:#0000ff;">13 дек 2016 в 19:53</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><a name="comment-69463022"></a>Я согласен. Я нуб стека. Виноват </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">– <a href="https://stackoverflow.com/users/7037499/dfresh22"><span style=" text-decoration: underline; color:#0000ff;">dfresh22</span></a> <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#comment69463022_41127467"><span style=" text-decoration: underline; color:#0000ff;">13 дек 2016 в 20:00</span></a></p>
<li style="" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comment-69468141"></a>1</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">Альтернативный ручной процесс: откройте панель «Запросы рабочей книги» для исходного файла, выберите все запросы, щелкните правой кнопкой мыши и выберите «Копировать», откройте панель «Запросы рабочей книги» для целевого файла, щелкните правой кнопкой мыши и выберите «Вставить». </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;">– <a href="https://stackoverflow.com/users/1787137/mike-honey"><span style=" text-decoration: underline; color:#0000ff;">Майк Хани</span></a> <a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#comment69468141_41127467"><span style=" text-decoration: underline; color:#0000ff;">13 дек 2016 в 22:52</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comments-link-41127467"></a><a href="https://stackoverflow.com/questions/41127467/export-power-queries-from-one-workbook-to-another-with-vba#"><span style=" text-decoration: underline; color:#0000ff;">Д</span></a><span style=" text-decoration: underline; color:#0000ff;">обавить комментарий</span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="answers"></a><span style=" font-size:x-large; font-weight:600;">1</span><span style=" font-size:x-large; font-weight:600;"> ответ</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мне удалось решить эту проблему, используя объект Workbook.Query.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">вот мое решение.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">Public Sub FunctionToTest_ForStackOverflow()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' Doug.Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim wb As Workbook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' create empty workbook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Set NewBook = Workbooks.Add</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Set wb = NewBook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' copy queries</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                CopyPowerQueries ThisWorkbook, wb, </span><span style=" font-family:'Consolas';">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">End Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">Public Sub CopyPowerQueries(wb1 As Workbook, wb2 As Workbook, Optional ByVal copySourceData As Boolean)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' Doug.Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' copy power queries into new workbook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim qry As WorkbookQuery</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">For Each qry In wb1.Queries</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">' copy source data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">If copySourceData Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                        CopySourceDataFromPowerQuery wb1, wb2, qry</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">' add query to workbook</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    wb2.Queries.Add qry.Name, qry.formula, qry.Description</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Next</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">End Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">Public Sub CopySourceDataFromPowerQuery(wb1 As Workbook, wb2 As Workbook, qry As WorkbookQuery)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' Doug.Long</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">' copy source data by pulling data out from workbook into other</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim qryStr As String</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim sourceStrCount As Integer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim i As Integer</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim tbl As ListObject</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Dim sht As Worksheet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                sourceStrCount = (Len(qry.formula) - Len(Replace$(qry.formula, </span><span style=" font-family:'Consolas';">&quot;Source = Excel.CurrentWorkbook()&quot;, &quot;&quot;))) / Len(&quot;Source = Excel.CurrentWorkbook()&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">For i = 1 To sourceStrCount</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    qryStr = Split(Split(qry.formula, </span><span style=" font-family:'Consolas';">&quot;Source = Excel.CurrentWorkbook(){[Name=&quot;&quot;&quot;)(1), &quot;&quot;&quot;]}&quot;)(0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">For Each sht In wb1.Worksheets</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                        </span><span style=" font-family:'Consolas';">For Each tbl In sht.ListObjects</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                            </span><span style=" font-family:'Consolas';">If tbl.Name = qryStr Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                                </span><span style=" font-family:'Consolas';">If Not sheetExists(sht.Name) Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                                    sht.Copy After:=wb2.Sheets(wb2.Sheets.Count)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                                </span><span style=" font-family:'Consolas';">End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                            </span><span style=" font-family:'Consolas';">End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                        </span><span style=" font-family:'Consolas';">Next tbl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">Next sht</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Next i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                qryStr = qry.formula</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">End Sub</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">Function sheetExists(sheetToFind As String) As Boolean</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">'http://stackoverflow.com/questions/6040164/excel-vba-if-worksheetwsname-exists</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                sheetExists = </span><span style=" font-family:'Consolas';">False</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">For Each sheet In Worksheets</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">If sheetToFind = sheet.Name Then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                        sheetExists = </span><span style=" font-family:'Consolas';">True</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                        </span><span style=" font-family:'Consolas';">Exit Function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                    </span><span style=" font-family:'Consolas';">End If</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">                </span><span style=" font-family:'Consolas';">Next sheet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas'; background-color:#eff0f1;">            </span><span style=" font-family:'Consolas';">End Function</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:10px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p></body></html>