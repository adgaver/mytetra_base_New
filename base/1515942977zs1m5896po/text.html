<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">16. Дополнение </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="aswift_0_expand"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">6.1. Интерактивный режим</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">16.1.1. Обработка ошибок</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Когда происходит ошибка, интерпретатор выводит сообщение о ней и трассировку стека. В интерактивном режиме он затем возвращается к первичному приглашению; когда ввод поступает из файла, он выходит с ненулевым выходным статусом после печати трассировки стека. (Исключения, обработанные разделом except (docs.python.org/3/reference/compound_stmts.html#except)  оператора try (docs.python.org/3/reference/compound_stmts.html#try), не являются ошибками в этом случае.) Некоторые ошибки безусловно фатальны и являются причиной ненулевого выхода; это применяется для внутренних несоответствий и ряда случаев нехватки памяти. Все сообщения об ошибках записываются в стандартный поток ошибок; в обычный вывод выполненных команд записывается стандартный вывод. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Ввод прерывающего символа (обычно Control-C или Delete) в первичном или вторичном приглашении отменяет ввод и возвращает к первичному приглашению. </span><a name="id1"></a><a href="http://pythoner.name/documentation/tutorial/appendix#id11"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">[</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">1]</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> Ввод прерывания в то время как команда выполняется возбуждает исключение KeyboardInterrupt (docs.python.org/3/library/exceptions.html#KeyboardInterrupt), которое может быть обработано оператором try. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="tut-scripts"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">6.1.2. Исполняемые скрипты Python</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">На BSD-подобных Unix-системах скрипты Python можно сделать сразу выполняемыми подобно shell-скриптам, введя строку </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">#!/usr/bin/env python3.5</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">(предполагая, что интерпретатор есть на PATH пользователя) в начале скрипта и задав файлу исполняемый режим. </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">#!</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> должны быть первыми двумя символами файла. На некоторых платформах эта первая строка должна заканчиваться окончанием строки в Unix-стиле (</span><span style=" font-family:'Courier New,courier'; font-size:9pt;">'\n'</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">), не окончанием строки Windows (</span><span style=" font-family:'Courier New,courier'; font-size:9pt;">'\r\n'</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">). Заметьте, что символ хэша, </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">'#'</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, используется для обозначения начала комментария в Python. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Скрипту может быть передан исполняемый режим, или разрешения, с помощью команды </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">chmod</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">$ chmod +x myscript.py</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">В системах Windows нет понятия &quot;исполняемый режим&quot;. Установщик Python автоматически ассоциирует файлы </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">.py</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> с </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">python.exe</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, так что двойной клик на Python-файле запустит его как скрипт. Расширение может быть .pyw, в этом случае окно консоли, которое обычно появляется, подавляется. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">16.1.3. Интерактивный загрузочный файл</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Когда вы используете Python интерактивно, часто</span><a name="result_box"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">удобно иметь некоторые стандартные команды, выполняемые каждый раз при запуске интерпретатора. Вы можете сделать это, связав переменную окружения PYTHONSTARTUP (docs.python.org/3/using/cmdline.html#envvar-PYTHONSTARTUP) с именем файла, содержащем загрузочные команды. Это похоже на возможности </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">.profile</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> оболочек Unix. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Этот файл читается только в интерактивных сессиях, не когда Python читает команды из скрипта и не когда </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">/dev/tty</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> задан как явный источник команд (который иначе ведет себя как интерактивная сессия). Он выполняется в том же пространстве имен, котором выполняются интерактивные команды, так что объекты, которые он определяет или импортирует, могут быть использованы без квалификации в интерактивном сеансе. Вы также можете изменить в этом файле приглашения </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">sys.ps1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> и </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">sys.ps2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Если вы хотите прочитать дополнительный загрузочный файл из текущей директории, то можете запрограммировать это в глобальном загрузочном файле, используя код наподобие </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">if os.path.isfile('.pythonrc.py'): exec(open('.pythonrc.py').read())</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. Если вы хотите использовать загрузочный файл в скрипте, то должны сделать это явно в скрипте: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">import os</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">filename = os.environ.get('PYTHONSTARTUP')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">if filename and os.path.isfile(filename):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">    with open(filename) as fobj:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">        startup_file = fobj.read()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">    exec(startup_file)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">16.1.4. Настройка модулей</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Python предоставляет два хука, чтобы позволить вам настроить это: </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">sitecustomize</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> и </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">usercustomize</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. Чтобы увидеть, как это работает, вам сначала надо найти местонахождение вашей пользовательской директории site-пакетов. Запустите Python и выполните этот код: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">&gt;&gt;&gt; import site</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">&gt;&gt;&gt; site.getusersitepackages()</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">'/home/user/.local/lib/python3.5/site-packages'</span><span style=" font-family:'DejaVu LGC Sans'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">Теперь вы можете создать файл под именем usercustomize.py в той директории и положить в нее что-нибудь, что вы хотите. Оно будет влиять на каждый вызов Python, </span><a name="result_box"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">е</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">сли только он не запущен с опцией </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">-s</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">, чтобы отключить автоматический импорт. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:9pt;">sitecustomize</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> работает похожим образом, но обычно создается администратором компьютера в глобальной директории site-пакетов и импортируется перед </span><span style=" font-family:'Courier New,courier'; font-size:9pt;">usercustomize</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">. См. документацию по модулю site (docs.python.org/3/library/site.html#module-site) для более полной информации. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Примечания</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="id11"></a><a href="http://pythoner.name/documentation/tutorial/appendix#id1"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">[</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; text-decoration: underline; color:#0000ff;">1]</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;"> </span><a name="result_box"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">П</span><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">роблема с пакетом GNU Readline может помешать этому.</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:600;">Создано</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:9pt;">2017-07-10 </span></p></body></html>