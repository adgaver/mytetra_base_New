<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:9pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Вырезано из </span><a href="https://excelpedia.ru/makrosi-v-excel/preobrazovat-svodnuyu-tablicu-v-formuli"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">https://excelpedia.ru/makrosi-v-excel/preobrazovat-svodnuyu-tablicu-v-formuli</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:16pt; font-weight:600; color:#1e4e79;">Преобразование сводной таблицы в формулы SUMIFS — бесплатный макрос VBA</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Автор Дмитрий Якушев На чтение 14 мин. Просмотров 73 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Этот пост содержит бесплатный макрос VBA, который преобразует любую сводную таблицу в отчет, содержащий формулы SUMIFS, COUNTIFS или AVERAGEIFS. Если вы хотите очень быстро создать длинную формулу SUMIFS, это ваш билет.</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Содержание</span><span style=" font-size:8.25pt;"> </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#svodnaya-tablitsa-ili-formuly-sumifs"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Сводная таблица или Формулы SUMIFS?</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#svodnye-tablitsy"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Сводные таблицы</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#formuly-sumifs"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Формулы SUMIFS</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#preobrazovat-svodnuyu-tablitsu-v-formuly"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Преобразовать сводную таблицу в формулы SUMIFS</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#chto-konkretno-delaet-makros"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Что конкретно делает макрос?</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#napisanie-makrosa"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Написание макроса</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#kod-vba"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Код VBA</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#kak-realizovat-etot-kod"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Как реализовать этот код</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#dobavte-modul-koda-v-vashu-lichnuyu-knigu"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Добавьте модуль кода в вашу личную книгу макросов</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#rabotaet-s-tablitsami-i-strukturirovannymi"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Работает с таблицами и структурированными ссылками</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#rabotaet-s-filtrom-stranitsy-neskolkih-kriteriev"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Работает с фильтром страницы нескольких критериев</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#stati-po-teme"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Статьи по теме</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#vba-svodnaya-tablitsa-ssylki"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">VBA Сводная таблица Ссылки</span></a> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://excelpedia.ru/#skachat-fayl"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Скачать файл</span></a> </li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Сводная таблица или Формулы SUMIFS?</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Что лучше — сводная таблица или формулы SUMIFS? Это старый вопрос при создании пользовательского отчета или панели мониторинга, и теперь вы можете иметь и то, и другое!</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Сводные таблицы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Преимущество сводных таблиц заключается в том, что вы можете быстро создать красиво отформатированный отчет, который обобщает ваши данные. Они очень быстрые и мощные, и экономят много времени.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Недостатком является то, что расположение сводной таблицы на рабочем листе может быть ограничивающим. Вам может потребоваться больше гибкости в структуре обобщенных данных при создании пользовательских диаграмм, панелей мониторинга, интерактивных отчетов и т.д. Сводные таблицы также требуют, чтобы пользователь вручную обновлял их при обновлении исходных данных.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Формулы SUMIFS</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Это может привести нас к использованию формул SUMIFS вместо сводной таблицы.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Преимущество формул SUMIFS заключается в том, что вы можете рассчитать сумму на основе нескольких критериев в любом месте таблицы. Они также рассчитываются автоматически при обновлении исходных данных.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Недостатком является то, что SUMIFS — это длинные формулы, которые требуют много времени для ввода. Они также более подвержены ошибкам и требуют большего обслуживания при изменении диапазона исходных данных (добавлены новые строки).</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Преобразовать сводную таблицу в формулы SUMIFS</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Недавно я работал над проектом, в котором я писал множество формул SUMIFS для перетаскивания чисел на панель инструментов. Формулы SUMIFS отлично подходят для этого, потому что вы можете сделать панель мониторинга интерактивной, используя выпадающие списки (проверка ячеек), и результаты обновляются автоматически.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Моя проблема заключалась в том, что я тратил много времени на написание различных формул SUMIFS. Я хотел быстро создать эти длинные формулы.</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Поэтому я написал этот макрос, который берет сводную таблицу и преобразует ее в формулы SUMIFS, COUNTIFS или AVERAGEIFS. Это означает, что вы можете в основном писать формулы, используя удобство сводной таблицы. Когда в вашей сводной таблице есть все поля, необходимые для формулы SUMIFS, вы просто нажимаете кнопку для создания формул.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Что конкретно делает макрос?</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Код VBA приведен ниже, и вы также можете скачать рабочую книгу, содержащую этот код. Я также объясню несколько способов использования этого кода ниже. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Вот общее описание того, что делает макрос: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Создает новый лист в книге.</span> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Копирует оболочку сводной таблицы на новый лист (строки, столбцы, области фильтрации страниц и форматирование).</span> </li>
<li style=" font-family:'Calibri'; font-size:11pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Перебирает каждую ячейку в области значений и создает формулу SUMIFS, COUNTIFS или AVERAGEIFS на новом листе. Формулы имитируют вычисление поля значений в сводной таблице.</span> </li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Вы можете использовать новый лист в качестве основы для своего настраиваемого отчета или скопировать формулы на другой лист в рабочей книге. Есть много способов, как вы могли бы использовать это. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Написание макроса</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Самым сложным в создании этого кода является обработка всех потенциальных макетов сводной таблицы. Сводная таблица может иметь компактную, контурную или табличную форму, а итоги и промежуточные итоги отображаются в разных местах.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Для формул SUMIFS наиболее удобный макет будет табличным с повторяющимися элементами. Но я не хотел ограничивать код только этим, поэтому я попытался приспособить все возможности макета.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Я не могу сказать, что код еще совершенен, но он обрабатывает все макеты, которые я тестировал до сих пор. Я уверен, что вы найдете ошибки, и я буду обновлять код по мере возникновения проблем.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Код VBA</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Загрузите файл, содержащий код и примеры. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelpedia.ru/wp-content/files/vba/Convert-Pivot-Table-To-SUMIFS-Formulas.xlsm"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Convert Pivot Table To SUMIFS Formulas.xlsm</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> (170.6 KB)</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<table border="0" style=" border-color:#a3a3a3; border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p></td>
<td style=" vertical-align:top; padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">PivotTable</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">rSource As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Range</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsSource As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Worksheet</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Boolean</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Sub</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Convert_Pivot_to_Formulas()</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'все ячейки в области значений для формул SUMIFS, COUNTIFS или AVERAGEIFS</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Подробности: ниже приведен список функций, требований и ограничений макроса.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Характеристики</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'- Работает с полями страницы с несколькими элементами в фильтре одного поля страницы.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'- Создает критерии поля страницы по столбцам и создает формулы массива.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Требования</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'- Поля в сводной таблице, содержащие даты, должны быть в том же формате, что и исходные данные.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'- Исходные данные должны быть в той же книге. Это может быть расширено для ссылки на исходные данные в других книгах.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Ограничения</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'- Не работает с сгруппированными полями даты. Диапазоны критериев НЕ существуют в исходных данных.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Для решения этой проблемы создайте поля группы дат в виде столбцов в исходных данных.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'---------------------------------------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">PivotItem</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">PivotCell</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pf As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">PivotField</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsNew As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Worksheet</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsPivot As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Worksheet</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">c As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Range</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lFunction As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Long</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sSumRange As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sCritRange As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sCriteria As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormula As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sSearchField As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sDataSheet As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lDataRows As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Long</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sPageRange As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lCol As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Long</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bArray As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Boolean</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sTableName As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaCnt As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">String</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblRow As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Long</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblCol As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Long</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Установить переменные сводной таблицы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Resume</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt = ActiveCell.PivotTable</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsPivot = ActiveSheet</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">GoTo</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">0</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt Is</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Nothing</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;"> MsgBox &quot;Please select a Pivot Table first.&quot;, vbOKOnly, &quot;Convert Pivot to Formula Error&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;"> Exit</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;"> End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Проверьте, находятся ли исходные данные в той же книге.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">  If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Get_Pivot_Source Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">  On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">GoTo</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Err_Handle</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'1. Создайте новый лист с оболочкой сводной таблицы - фильтр, строки, области столбцов</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsNew = Worksheets.Add(after:=ActiveSheet)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sDataSheet = wsSource.Name</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lDataRows = rSource.Rows.Count</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable Then</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sTableName = pvt.SourceData</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Скопируйте значения сводной таблицы на новый лист</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsPivot.Select</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsPivot.Range(pvt.TableRange1.Address).Copy</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">With</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Range(pvt.TableRange1.Address)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteValues</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteFormats</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteColumnWidths</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">With</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt.PageFields.Count &gt; 0 Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsPivot.Range(pvt.PageRange.Address).Copy</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">With</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Range(pvt.PageRange.Address)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteValues</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteFormats</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">.PasteSpecial Paste:=xlPasteColumnWidths</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">With</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'2. Добавьте фильтры полей страницы по столбцам в новом листе.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt.PageFields.Count &gt; 0 Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Each</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pf In</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt.PageFields</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sPageRange = pf.LabelRange.Offset(, 1).Resize(1,1).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFilter = pf.LabelRange.Offset(, 1).Resize(1, 1).Value</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lCol = 0 'offset 1 col to the right</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Select</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFilter</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&quot;(All)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Пропуск</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&quot;(Multiple Items)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Зацикливайте элементы поворота и добавляйте выбранные элементы в диапазон страниц по столбцам.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Each</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi In</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pf.PivotItems</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi.Visible Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Range(sPageRange).Offset(, lCol).Resize(1,1).Value = pi.Name</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lCol = lCol + 1</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">' Один предмет выбран</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lCol = 1</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsPivot.Range(sPageRange).Offset(, lCol).Resize(1, 1).Value = wsNew.Range(sPageRange).Offset(, lCol).Resize(1, 1).Value</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Select</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">               </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Создать строку для формулы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lCol &gt; 0 Then</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">' фильтры существуют</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = sTableName &amp;amp; &quot;[&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; pf.Name &amp;amp; &quot;]&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSearchField = pf.Name</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = &quot;'&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sDataSheet &amp;amp; &quot;'!&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; rSource.Resize(1).Find(What:=sSearchField, LookAt:=xlWhole).Offset(1).Resize(lDataRows - 1, 1).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = wsNew.Range(sPageRange).Resize(1, lCol).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">               </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage = sFormulaPage &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCritRange</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage = sFormulaPage &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCriteria</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Формула IFS должна быть массивом, если в аргументе критерия есть несколько критериев (диапазон)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lCol &gt; 1 Then</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bArray = True</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pf</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'3. Прокрутите каждую ячейку в области значений, чтобы построить формулу.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Each</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">c In</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt.DataBodyRange.Cells</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc = c.PivotCell</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'4. Создайте ссылку SUM RANGE для формулы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Проверьте, является ли функция суммой, количеством или средним</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.PivotField.Function</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">= xlSum Or</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.PivotField.Function</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">= xlCount Or</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.PivotField.Function</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">= xlAverage Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Подсчитайте критерии, если 0, то это всего и не требуется IFS</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Добавить элементы столбца в массив фильтра</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.PivotCellType = xlPivotCellValue Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sDataField = pc.PivotField.SourceName</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lFunction = pc.PivotField.Function</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Добавить диапазон сумм</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lFunction = pc.PivotField.Function</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSumRange = sTableName &amp;amp; &quot;[&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; pc.PivotField.SourceName &amp;amp; &quot;]&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSearchField = pc.PivotField.SourceName</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSumRange = &quot;'&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sDataSheet &amp;amp; &quot;'!&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; rSource.Resize(1).Find(What:=sSearchField, LookAt:=xlWhole).Offset(1).Resize(lDataRows - 1, 1).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'5. Переберите элементы ROW в сводной ячейке и добавьте ссылки на строки в формулу.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.RowItems.Count Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Each</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi In</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.RowItems</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = sTableName &amp;amp; &quot;[&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; pi.Parent.Name &amp;amp; &quot;]&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSearchField = pi.Parent.Name</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = &quot;'&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sDataSheet &amp;amp; &quot;'!&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; rSource.Resize(1).Find(What:=sSearchField, LookAt:=xlWhole).Offset(1).Resize(lDataRows - 1, 1).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                              </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Найти адрес диапазона меток сводных ячеек для адреса критерия</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Начните с текущей строки и выполните цикл по диапазону меток до</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Имя элемента сводной таблицы найдено. Требуется из-за разнообразия макетов сводных таблиц.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lLblCol = pi.LabelRange.Column</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblRow = c.Row To</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi.Parent.LabelRange.Row + 1 Step</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">-1</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Cells(lLblRow, lLblCol).Value = pi.Name Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = Cells(lLblRow, pi.LabelRange.Column).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Exit</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblRow</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                        </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sCriteria &lt;&gt; &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = sFormulaArgs &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCritRange</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = sFormulaArgs &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCriteria</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">  </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'6. Просмотрите элементы COLUMN в сводной ячейке и добавьте ссылки на ряды в формулу.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.ColumnItems.Count Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Each</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi In</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.ColumnItems</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bTable Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = sTableName &amp;amp; &quot;[&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; pi.Parent.Name &amp;amp; &quot;]&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sSearchField = pi.Parent.Name</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCritRange = &quot;'&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sDataSheet &amp;amp; &quot;'!&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; rSource.Resize(1).Find(What:=sSearchField, LookAt:=xlWhole).Offset(1).Resize(lDataRows - 1, 1).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Найти адрес диапазона меток сводных ячеек для адреса критерия</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Начните с текущего столбца и возвращайтесь влево через диапазон меток до</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Имя элемента сводной таблицы найдено. Требуется из-за разнообразия макетов сводных таблиц.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">lLblRow = pi.LabelRange.Row</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblCol = c.Column To</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi.LabelRange.Column Step</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">-1</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Cells(lLblRow, lLblCol).Value = pi.Name Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = Cells(pi.LabelRange.Row, lLblCol).Address</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Exit</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">For</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">lLblCol</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sCriteria &lt;&gt; &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = sFormulaArgs &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCritRange</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = sFormulaArgs &amp;amp; &quot;,&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sCriteria</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sCriteria = &quot;&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pi</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'7. Формула построения на основе типа функции сводной ячейки</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Select</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pc.PivotField.Function</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">xlSum</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">And</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Не нужен IFS, когда нет критериев (всего строк / столбцов)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=SUM(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bArray Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=SUM(SUMIFS(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; sFormulaPage &amp;amp; sFormulaArgs &amp;amp; &quot;))&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=SUMIFS(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; sFormulaPage &amp;amp; sFormulaArgs &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">xlCount</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">And</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Не нужен IFS, когда нет критериев (всего строк / столбцов)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=COUNT(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormulaCnt = sFormulaPage &amp;amp; sFormulaArgs </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'Не нужно диапазон суммы для показателей                                sFormulaCnt = Right(sFormulaCnt, Len(sFormulaCnt) - 1) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' обрезать перед запятой</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                                </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bArray Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=SUM(COUNTIFS(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sFormulaCnt &amp;amp; &quot;))&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=COUNTIFS(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sFormulaCnt &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                           </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Case</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">xlAverage</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaArgs = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">And</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">sFormulaPage = &quot;&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Не нужен IFS, когда нет критериев (всего строк / столбцов)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=AVERAGE(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">sFormula = &quot;=AVERAGEIFS(&quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; sSumRange &amp;amp; sFormulaPage &amp;amp; sFormulaArgs &amp;amp; &quot;)&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' AVERAGEIFS не работает с формулой массива, возвращает ошибки</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                            </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Select</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'8. Добавить формулу на новый лист</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'-------------------------------------------------------</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bArray Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Len(sFormula) &lt; 255 Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Range(c.Address).FormulaArray = sFormula</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'.FormulaArray выдает ошибку, если строка формулы&gt; 255 символов</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Добавить обработку ошибок здесь</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Range(c.Address).Formula = sFormula</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">                   </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Next</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">c</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">wsNew.Select</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Exit</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Err_Handle:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">MsgBox Err.Description &amp;amp; vbNewLine &amp;amp; &quot;Current Cell: &quot;</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">&amp;amp; c.Address, _</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">vbCritical, &quot;Convert Pivot to Formulas Error&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Sub</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Function</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Get_Pivot_Source() As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Boolean</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Dim</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">bReturn As</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Boolean</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Определите, является ли источник ссылкой на ячейку, именованным диапазоном или таблицей Excel.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Установите исходные переменные диапазона</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Попробуйте проверить свойство PivotCache.SourceType.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">'</span><a href="http://msdn.microsoft.com/en-us/library/office/ff194557.aspx"><span style=" font-family:'consolas'; font-size:12pt; text-decoration: underline; color:#0000ff;">http://msdn.microsoft.com/en-us/library/office/ff194557.aspx</span></a><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;"> On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">GoTo</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Err_Handler</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">' Установить переменные для выбранной сводной таблицы</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">bReturn = False</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">rSource = Nothing</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsSource = Nothing</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">bTable = False</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">   </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">pvt.PivotCache.SourceType = xlDatabase Then</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">InStr(pvt.SourceData, &quot;[&quot;) = 0 Then</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">' проверить, содержат ли исходные данные имя книги - обойти диапазон внешнего источника - Temp TO DO</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">InStr(pvt.SourceData, &quot;:&quot;) &gt; 0 Then</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">' если диапазон источника данных является диапазоном ссылки на ячейку</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">rSource = Application.Evaluate(Application.ConvertFormula(pvt.SourceData, xlR1C1, xlA1))</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Else</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">' если таблица или именованный диапазон используются в качестве диапазона источника данных</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">rSource = Range(pvt.SourceData)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">GoTo</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">SkipTable ' проверить, является ли имя источника данных таблицей</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">rSource = Range(pvt.SourceData &amp;amp; &quot;[#All]&quot;)</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">bTable = True</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">SkipTable:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">On</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Error</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">GoTo</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">0</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Set</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">wsSource = rSource.Parent</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">bReturn = True</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">If</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">   </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Get_Pivot_Source = bReturn</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Exit</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Function</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Err_Handler:</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">    </span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">MsgBox &quot;Error in Get_Source_Range procedure.&quot;</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">Get_Pivot_Source = False</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'consolas'; font-size:12pt;">End</span><span style=" font-family:'Verdana'; font-size:12pt;"> </span><span style=" font-family:'consolas'; font-size:12pt;">Function</span><span style=" font-size:8.25pt;"> </span></p></td></tr></table>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Как реализовать этот код</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Не волнуйтесь, если весь этот код заставляет вашу голову кружиться. Скоро выйдет новая надстройка с именем </span><span style=" font-family:'Verdana'; font-size:12pt; font-weight:600;">PivotPal,</span><span style=" font-family:'Verdana'; font-size:12pt;"> которая будет содержать эту функцию.</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Это означает, что вы сможете запускать этот макрос в любое время одним нажатием кнопки. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Добавьте модуль кода в вашу личную книгу макросов</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Вы также можете добавить код в свою личную книгу макросов, а затем назначить ей кнопку ленты. Вот </span><a href="https://www.myonlinetraininghub.com/create-a-personal-macro-workbook-personal-xlsb"><span style=" font-family:'Verdana'; font-size:12pt; font-weight:600; text-decoration: underline; color:#0000ff;">статья </span></a><span style=" font-family:'Verdana'; font-size:12pt; font-weight:600;">о том, как создать личную макрокоманду.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">На снимке экрана ниже я добавил макрос в свою личную книгу макросов, а затем назначил ей кнопку на вкладке «Формулы» на ленте.</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Вы также можете скопировать модуль кода в любую рабочую книгу и изменить или настроить его по мере необходимости. Есть много возможностей с этим кодом. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Работает с таблицами и структурированными ссылками</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Код также работает </span><span style=" font-family:'Verdana'; font-size:12pt; font-weight:600;">с таблицами Excel</span><span style=" font-family:'Verdana'; font-size:12pt;"> и структурированными ссылками. Если ваш диапазон исходных данных представляет собой таблицу, то код создаст гораздо более приятные на вид формулы. Эти формулы более динамичны, когда строки добавляются к исходным данным. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Это означает, что формулы будут автоматически включать любые новые строки, которые добавляются в таблицу (исходные данные). Использование таблиц значительно сократит объем обслуживания, которое потребуется вашим формулам.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Работает с фильтром страницы нескольких критериев</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Код будет работать, если в вашей сводной таблице есть фильтр страниц с несколькими выбранными критериями. Код обнаружит, когда в фильтре выбрано несколько критериев, и создаст формулы массива для SUMIFS. Также будут перечислены критерии в столбцах справа от полей страницы.</span><span style=" font-size:8.25pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Как вы можете видеть на рисунке выше, код работает с довольно сложными компоновками. Я не могу гарантировать, что он будет работать в каждом сценарии, но он определенно должен охватывать не только основы. </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Статьи по теме</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Mynda Treacy недавно написала отличную статью о формулах </span><a href="https://www.myonlinetraininghub.com/interactive-excel-formulas"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Interactive Excel</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> и объясняет, как вы можете использовать формулы SUMIFS для своих отчетов и панелей мониторинга. Не забудьте проверить мои </span><a href="https://www.excelcampus.com/charts/excel-dashboard-course-review/"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">бесплатные призы</span></a><span style=" font-family:'Verdana'; font-size:12pt;">, когда вы записываетесь на один из курсов Mynda.</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">VBA Сводная таблица Ссылки</span><span style=" font-size:8.25pt;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Ниже приведены несколько отличных статей и ресурсов для обучения написанию VBA для сводных таблиц. Они действительно помогли мне написать этот код.</span><span style=" font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-size:8.25pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.contextures.com/excel-vba-pivot-table-field-list.html"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Информационный список полей сводной таблицы Excel VBA</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> — Дебра Далглиш</span> </li>
<li style=" font-size:8.25pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://peltiertech.com/referencing-pivot-table-ranges-in-vba/"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Ссылки на диапазоны сводных таблиц в VBA</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> — Джон Пельтье</span> </li>
<li style=" font-size:8.25pt; vertical-align:middle;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://dailydoseofexcel.com/archives/2010/11/04/getting-the-source-range-of-a-pivot-table-with-vba/"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Получение исходного диапазона сводной таблицы с помощью VBA</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> — Дик Куслейка</span> </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Calibri'; font-size:14pt; font-weight:600; color:#2e75b5;">Скачать файл </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana'; font-size:12pt;">Загрузите файл, содержащий код и примеры. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://excelpedia.ru/wp-content/files/vba/Convert-Pivot-Table-To-SUMIFS-Formulas.xlsm"><span style=" font-family:'Verdana'; font-size:12pt; text-decoration: underline; color:#0000ff;">Convert Pivot Table To SUMIFS Formulas.xlsm</span></a><span style=" font-family:'Verdana'; font-size:12pt;"> (170.6 KB)</span><span style=" font-size:8.25pt;"> </span></p></body></html>