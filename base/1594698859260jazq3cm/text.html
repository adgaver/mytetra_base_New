<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'MS Shell Dlg 2'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:24pt; font-weight:600;">Параметризация путей к данным в Power Query</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans'; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">=ЛЕВСИМВ(ЯЧЕЙКА(&quot;имяфайла&quot;);НАЙТИ(&quot;[&quot;;ЯЧЕЙКА(&quot;имяфайла&quot;))-1) &amp;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">ЛЕВСИМВ(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">    ПРАВСИМВ(ЯЧЕЙКА(&quot;имяфайла&quot;);ДЛСТР(ЯЧЕЙКА(&quot;имяфайла&quot;))-НАЙТИ(&quot;[&quot;;ЯЧЕЙКА(&quot;имяфайла&quot;)));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">    НАЙТИ(&quot;]&quot;;ПРАВСИМВ(ЯЧЕЙКА(&quot;имяфайла&quot;);ДЛСТР(ЯЧЕЙКА(&quot;имяфайла&quot;))-НАЙТИ(&quot;[&quot;;ЯЧЕЙКА(&quot;имяфайла&quot;))))-1)<br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;"><br /></span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">27432 09.12.2018 </span><a href="https://www.planetaexcel.ru/upload/iblock/408/power-query-source-parameterization.zip"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Скачать пример</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если вы уже начали использовать в работе инструменты </span><a href="https://www.planetaexcel.ru/techniques/24/5854/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">бесплатной надстройки Power Query</span></a><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> в Microsoft Excel, то очень скоро столкнётесь с одной узкоспециальной, но весьма частой и надоедливой проблемой, связанной с постоянно ломающимися ссылками на исходные данные. Суть проблемы в том, что если в своём запросе вы ссылаетесь на внешние файлы или папки, то Power Query жёстко прописывает абсолютный путь к ним в тексте запроса. У вас на компьютере всё работает прекрасно, но если вы решите отправить файл с запросом своим коллегам, то их ждёт разочарование, т.к. у них на компьютере путь к исходным данным уже другой, и наш запрос работать не будет. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Что же сделать в такой ситуации? Давайте рассмотрим этот случай подробнее на следующем примере. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Постановка задачи</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Предположим, что у нас в папке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">E:\Отчеты по продажам</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> лежит файл </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Топ-100 товаров.xls</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, представляющий собой выгрузку из нашей корпоративной базы данных или ERP-системы (1С, SAP и т.п.) Этот файл содержит информацию о наиболее популярных товарных позициях и выглядит внутри примерно так: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">С ходу, наверное, понятно, что работать с ним в Excel в таком виде практически невозможно: будут мешать пустые строки через одну с данными, объединенные ячейки, лишние столбцы, многоуровневая шапка и т.д.</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Поэтому рядом с этим файлом в той же папке мы создаём ещё один новый файл </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Обработчик.xlsx</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, в котором создадим запрос Power Query, который будет загружать страшненькие данные из исходного файла-выгрузки </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Топ-100 товаров.xls</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, и приводить их в порядок: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Создаем запрос к внешнему файлу</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Открыв файл </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Обработчик.xlsx</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, выберем на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Данные </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">команду </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Получить данные - Из файла - Из книги Excel </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Data - Get Data - From file - From Excel)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, затем укажем местоположение исходного файла и нужный нам лист. Выбранные данные загрузятся в редактор Power Query: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Приведём их в нормальный вид: </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Удалим пустые строки через </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Главная - Удалить строки - Удалить пустые строки </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Home - Remove Rows - Remove Empty Rows)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Удалим ненужные 4 верхних строки через </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Главная - Удалить строки - Удалить верхние строки </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Home - Remove Rows - Remove Top Rows)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Поднимем первую строку в шапку таблицы кнопкой </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Использовать первую строку в качестве заголовков</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Главная </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Home - Use first row as header)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Отделим пятизначный артикул от названия товара во втором столбце, используя команду </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Разделить столбец</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Преобразование </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Transform - Split Column)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">.</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Удалим ненужные столбцы и переименуем заголовки оставшихся для лучшей наглядности.</span> </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В итоге у нас должна получиться следующая, гораздо более приятная, картина: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Осталось эту облагороженную таблицу выгрузить обратно на лист в наш файл </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Обработчик.xlsx</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> командой </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Закрыть и загрузить </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Home - Close&amp;Load)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Главная</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Находим путь к файлу в запросе</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Теперь давайте посмотрим как выглядит наш запрос &quot;под капотом&quot;, на встроенном в Power Query внутреннем языке с лаконичным названием &quot;М&quot;. Для этого вернемся в наш запрос двойным щелчком по нему в правой панели </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Запросы и подключения</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> и на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Просмотр </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">выберем </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Расширенный редактор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(View - Advanced Editor)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">В открывшемся окне во второй строке сразу же обнаруживается жёстко прописанный путь к нашему исходному файлу выгрузки. Если мы сможем заменить эту текстовую строку на параметр, переменную или ссылку на ячейку листа Excel, где этот путь будет заранее прописан, то мы сможем впоследствии легко его менять. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Добавляем умную таблицу с путём к файлу </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Закроем пока Power Query и вернёмся в наш файл </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Обработчик.xlsx</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Добавим новый пустой лист и сделаем на нём маленькую &quot;умную&quot; таблицу, в единственной ячейке которой будет записан полный путь к нашему файлу исходных данных: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для создания &quot;умной&quot; таблицы из обычного диапазона можно использовать сочетание клавиш Ctrl+T или кнопку </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Форматировать как таблицу</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Главная </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Home - Format as Table)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Заголовок столбца (ячейка А1) может быть совершенно любым. Также обратите внимание, что для понятности я дал таблице имя </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Параметры </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Конструктор </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(Design)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Скопировать из Проводника путь или даже ввести его вручную не представляет, конечно, особой сложности, но лучше всего минимизировать человеческий фактор и определять путь, по возможности, автоматически. Это можно реализовать с помощью стандартной функции рабочего листа Excel </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ЯЧЕЙКА </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(CELL)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, которая умеет выдавать кучу полезной информации об указанной в качестве аргумента ячейке - в том числе и путь к текущему файлу: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Если предположить, что файл с исходными данными всегда лежит в той же папке, что и наш Обработчик, то путь, который нам нужен можно сформировать следующей формулой: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt;">=ЛЕВСИМВ(ЯЧЕЙКА(&quot;имяфайла&quot;);НАЙТИ(&quot;[&quot;;ЯЧЕЙКА(&quot;имяфайла&quot;))-1)&amp;&quot;Топ-100 товаров.xls&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#cccccc;">или в английской версии: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; color:#cccccc;">=LEFT(CELL(&quot;filename&quot;);FIND(&quot;[&quot;;CELL(&quot;filename&quot;))-1)&amp;&quot;Топ-100 товаров.xls&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">... где функция </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">ЛЕВСИМВ </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(LEFT)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;"> </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">берёт из полной ссылки кусок текста до открывающей квадратной скобки (т.е. путь к текущей папке), а затем к нему приклеивается имя и расширение нашего исходного файла с данными.</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Параметризуем путь в запросе</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Остался последний и самый главный штрих - прописать в запросе путь к исходному файлу </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Топ-100 товаров.xls</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, сославшись на ячейку А2 нашей созданной &quot;умной&quot; таблицы </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Параметры</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Для этого вернемся в запрос Power Query и ещё раз откроем </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Расширенный редактор</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> на вкладке </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Просмотр </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600; color:#cccccc;">(View - Advanced Editor)</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">. Вместо текстовой строки-пути в кавычках </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; color:#9d0039;">&quot;E:\Отчеты по продажам\Топ-100 товаров.xlsx&quot;</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> введём туда вот такую конструкцию: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#0000ff;">Excel.CurrentWorkbook()</span><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#00a650;">{[Name=&quot;Параметры&quot;]}[Content]</span><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#ee105a;">{0}</span><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600;">[Путь к исходным данным]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Давайте разберемся из чего она состоит: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#0000ff;">Excel.CurrentWorkbook()</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - это функция языка М для обращения к содержимому текущего файла</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#00a650;">{[Name=&quot;Параметры&quot;]}[Content]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - это уточняющий параметр к предыдущей функции, указывающий, что мы хотим получить содержимое &quot;умной&quot; таблицы </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Параметры</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600;">[Путь к исходным данным]</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - это имя столбца в таблице </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Параметры</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, к которому мы обращаемся</span> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:12pt; font-weight:600; color:#ee105a;">{0}</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;"> - это номер строки в таблице </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-style:italic;">Параметры</span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">, из которой мы хотим взять данные. Шапка - не в счет и нумерация начинается от нуля, а не от единицы.</span> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Вот и всё, собственно. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">Осталось нажать на </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt; font-weight:600;">Готово </span><span style=" font-family:'Times New Roman,serif'; font-size:12pt;">и проверить как работает наш запрос. Теперь при пересылке всей папки с обоими файлами внутри на другой ПК запрос будет сохранять работоспособность и определять путь к данным автоматически.</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman,serif'; font-size:13.5pt; font-weight:600;">Ссылки по теме</span><span style=" font-family:'DejaVu Sans'; font-size:11pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/24/5854/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Что такое Power Query и зачем он нужен при работе в Microsoft Excel</span></a> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/24/5754/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Как импортировать в Power Query плавающий фрагмент текста</span></a> </li>
<li style=" font-family:'DejaVu Sans'; font-size:11pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.planetaexcel.ru/techniques/24/55/"><span style=" font-family:'Times New Roman,serif'; font-size:12pt; text-decoration: underline; color:#0000ff;">Редизайн двумерной кросс-таблицы в плоскую с помощью Power Query</span></a> </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-size:11pt;">  </span></p></body></html>